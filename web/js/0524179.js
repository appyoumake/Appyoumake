function Mlab_api(){var self=this,documentOb=$(document);this.data_divider="/",this.db.parent=this,this.db.internal.parent=this.db,this.mode=this.getMode(),this.components={},this.db.plugins={},this.variables=new Object;var mlab_ready_triggered=!1,path=""+window.location.href.split("index.html")[0];return $.ajaxSetup({cache:!1}),$.get(path+"js/include_comp.txt").done(function(data){var components=data.split("\n"),componentsLength=components.length,componentsAdded=0;$.each(components,function(i,component){var name=component.replace("_code_rt.js","").replace("js/","");$.get(path+component,function(componentCode){eval("mlab.api.components['"+name+"'] = new function() {"+componentCode+"}();"),mlab.api.components[name].api=mlab.api,(componentsAdded+=1)==componentsLength&&$(document).trigger("mlabready")})})}).fail(function(){$(document).trigger("mlabready")}),this}Mlab_api.prototype={version:.9,getMode:function(){var e={mode:"design",device:"desktop"};return void 0===mlab.dt&&(e.mode="runtime"),void 0!==window.cordova&&(e.device="mobile"),e},getDeviceId:function(){if("mobile"==this.getMode().device)return device.uuid;var e=window.localStorage.getItem("GLOBAL");return e?e=JSON.parse(e):(e={device_uuid:this.getGUID()},window.localStorage.setItem("GLOBAL",JSON.stringify(e))),e.device_uuid},getAppUid:function(){return $('head > [name="mlab:app_uid"]').attr("content")},getGUID:function(){return"mlab_"+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},getLocale:function(){return this.parent.locale},getVariable:function(e,t){var a=$(e).find("script.mlab_storage").html();if(void 0!==a&&""!=a){try{var n=JSON.parse(a)}catch(e){return void console.log(e)}return n[t]}},getAllVariables:function(e){var t=$(e).find("script.mlab_storage").html();if(void 0!==t&&""!=t){try{var a=JSON.parse(t)}catch(e){return}return a}},setAppVariable:function(e,t,a){void 0===document.mlab_storage&&(document.mlab_storage={}),void 0===document.mlab_storage[e]&&(document.mlab_storage[e]={}),void 0===document.mlab_storage[e][t]&&(document.mlab_storage[e][t]={}),document.mlab_storage[e][t]=a},getAppVariable:function(e,t){if(void 0!==document.mlab_storage&&void 0!==document.mlab_storage[e]&&void 0!==document.mlab_storage[e][t])return document.mlab_storage[e][t]},db:{parent:null,retry_save_queue_counter:0,process_save_queue_counter:0,processing_queue:!1,process_save_queue_interval:3e3,process_save_queue_num_items:3,PLUGIN_NOT_USED:-1,PLUGIN_OFFLINE:-2,PLUGIN_NO_FUNCTION:-3,PLUGIN_NO_DATA:-4,setupStoragePlugin:function(e,t){var a,n=$(e).attr("id"),i=this.parent.getVariable(e,"storage_plugin");return!!i&&("name"in i&&i.name in this.parent.components&&(a=this.parent.components[i.name]),!!a&&("_data"in a||(a._data={}),a._data[n]={},a._data[n].settings=i,a._data[n].html_element=e,a._data[n].owner_uuid=n,this.plugins[n]=a,"onPluginLoaded"in a&&a.onPluginLoaded(e,t),this.processing_queue||(window.setInterval(mlab.api.db.internal.processFailedQueue(),this.process_save_queue_interval),this.processing_queue=!0),!0))},setState:function(e,t,a,n,i){return this.internal.setData("state",e,t,a,n,i)},getState:function(e,t,a,n){return this.internal.getData("state",e,t,a,n)},getAllState:function(e,t,a){return this.internal.getAllData("state",e,t,a)},setConfig:function(e,t,a,n,i){return this.internal.setData("config",e,t,a,n,i)},getConfig:function(e,t,a,n){return this.internal.getData("config",e,t,a,n)},getAllConfig:function(e,t,a){return this.internal.getAllData("config",e,t,a)},setResult:function(e,t,a,n,i){return this.internal.setData("result",e,t,a,n,i)},getResult:function(e,t,a,n){return this.internal.getData("result",e,t,a,n)},getAllResult:function(e,t,a){return this.internal.getAllData("result",e,t,a)},loginRemotely:function(e,t){var a=this.loginToken(e);return a||(e in this.parent.plugins&&"function"==typeof this.parent.plugins[e].loginRemotely&&(opDone=this.parent.plugins[e].loginRemotely(this.parent.plugins[e],t),"undefined"!=typeof opDone)?opDone:void 0)},logoffRemotely:function(e){var t=this.loginToken(e);return!!t&&(e in this.parent.plugins&&"function"==typeof this.parent.plugins[e].logoffRemotely&&(opDone=this.parent.plugins[e].logoffRemotely(this.parent.plugins[e],t,callback),"undefined"!=typeof opDone)&&opDone)},loginToken:function(e,t){return void 0!==e&&(void 0!==t&&window.sessionStorage.setItem("_LOGIN_TOKENS_"+e,t),window.sessionStorage.getItem("_LOGIN_TOKENS_"+e))},internal:{parent:null,dispatchToPlugin:function(e,t,a,n,i,o,r,s){var l;if(!o in this.parent.plugins)return this.parent.PLUGIN_NOT_USED;if(void 0===navigator.connection)p=!0;else var p=navigator.connection.type!=Connection.NONE;if(!p)return this.cbPluginFailed(a,n,i,o,r),this.parent.PLUGIN_OFFLINE;var c=this.cbPluginFailed;return o in this.parent.plugins&&"function"==typeof this.parent.plugins[o][t]?void 0!==(l=this.parent.plugins[o][t](c,e,n,i,o,r,s))?l:this.parent.PLUGIN_NO_DATA:this.parent.PLUGIN_NO_FUNCTION},cbPluginFailed:function(e,t,a,n,i){var o=this.parent.parent.data_divider,r=this.parent.retry_save_queue_counter++;window.localStorage.setItem("_QUEUE_"+r,e+o+t+o+a+o+n+o+i)},processFailedQueue:function(){if(void 0===navigator.connection);else navigator.connection.type,Connection.NONE;var e={data_type:null,app_uuid:null,device_uuid:null,component_uuid:null,key:null},t=this.parent.process_save_queue_counter;for(i=0;i<this.parent.process_save_queue_num_items;i++){console.log("processing q");var a=window.localStorage.getItem("_QUEUE_"+t);if(!a)return void console.log("nothing in q");var n=window.localStorage.getItem(a);if(!n)return void console.log("no value found for key: "+a);var o=a.split(mlab.api.data_divider);e.data_type=o[0],e.app_uuid=o[1],e.device_uuid=o[2],e.component_uuid=o[3],e.key=o[4],mlab.api.db.process_save_queue_counter++,mlab.api.db.internal.dispatchToPlugin(void 0,"set"+e.data_type.charAt(0).toUpperCase()+e.data_type.slice(1),e.data_type,e.app_uuid,e.device_uuid,e.component_uuid,e.key,n)||mlab.api.db.internal.cbPluginFailed(data_type,app_uuid,device_uuid,component_uuid,a)}},setData:function(e,t,a,n,i,o,r){if(void 0===r)var r=this.parent.parent.getAppUid();var s=this.parent.parent.data_divider;window.localStorage.setItem(e+s+r+s+t+s+a+s+n,JSON.stringify(i));var l=this.dispatchToPlugin(o,"set"+e.charAt(0).toUpperCase()+e.slice(1),e,r,t,a,n,i);if(!o||l!=this.parent.PLUGIN_NOT_USED&&l!=this.parent.PLUGIN_NO_FUNCTION){if(o&&(l==this.parent.PLUGIN_OFFLINE||l==this.parent.PLUGIN_NO_DATA))p=stale}else var p=fresh;if(o&&1!=l){var c={data:{},state:p};c.data[n]=i,o(c)}return!0},getData:function(e,t,a,n,i){var o=this.parent.parent.getAppUid(),r=this.dispatchToPlugin(i,"get"+e.charAt(0).toUpperCase()+e.slice(1),e,o,t,comp_id,n),s=this.parent.parent.data_divider;if(!i||r!=this.parent.PLUGIN_NOT_USED&&r!=this.parent.PLUGIN_NO_FUNCTION){if(i&&(r==this.parent.PLUGIN_OFFLINE||r==this.parent.PLUGIN_NO_DATA))l="stale"}else var l="fresh";if(i&&1!=r){var p={state:l,data:{}};p.data[n]=JSON.parse(window.localStorage.getItem(e+s+o+s+t+s+a+s+n)),i(p)}return!0},getAllData:function(e,t,a,n){var i=this.parent.parent.getAppUid(),o=this.dispatchToPlugin(n,"getAll"+e.charAt(0).toUpperCase()+e.slice(1),e,i,t,a),r=0;if(!0===o)return!0;if(!n||o!=this.parent.PLUGIN_NOT_USED&&o!=this.parent.PLUGIN_NO_FUNCTION){if(n&&(o==this.parent.PLUGIN_OFFLINE||o==this.parent.PLUGIN_NO_DATA))s="stale"}else var s="fresh";if(n&&1!=o){for(var l,p=0,c={},u=this.parent.parent.data_divider,d=e+u+i+u+t+u+a+u;l=window.localStorage.key(p);p++)r=d.length,l.substr(0,r)==d&&(c[l]=JSON.parse(window.localStorage.getItem(l)));n({data:c,state:s})}return!0},clearLocalStorage:function(){window.localStorage.clear()},clearSessionStorage:function(){window.sessionStorage.clear()}}},navigation:{current_page:0,max_pages:0,self:this,initialise:function(e,t){this.max_pages=t,this.pageDisplay(e)},pageDisplay:function(e,t){var a="",n=0;switch(e){case 0:case"index":a="000.html",n=0;break;case"first":a="001.html",n=1;break;case"last":a=("000"+this.max_pages).slice(-3)+".html",n=this.max_pages;break;case"next":if(this.current_page>=this.max_pages)return this.current_page;a=("000"+ ++this.current_page).slice(-3)+".html",n=this.current_page;break;case"previous":if(0===this.current_page||"index"===this.current_page)return this.current_page;--this.current_page<0&&(this.current_page=0),a=("000"+this.current_page).slice(-3)+".html",n=this.current_page;break;default:var i=parseInt(e);if(isNaN(i))return this.current_page;if(e<0||e>this.max_pages)return this.current_page;a=("000"+e).slice(-3)+".html",n=e}return t?$.mobile.pageContainer.pagecontainer("change",a,{transition:"slide"}):$.mobile.pageContainer.pagecontainer("change",a,{transition:"flip"}),this.current_page=n,this.current_page}},display:{prepareRegularComponents:function(e){console.log(e.type+" "+Date(e.timeStamp)),$('[data-mlab-type]:not([data-mlab-displaydependent="true"])').each(function(){var e=$(this).data("mlab-type");void 0!==mlab.api.components[e]&&void 0!==mlab.api.components[e].onPageLoad&&mlab.api.components[e].onPageLoad($(this),mlab.api.getAllVariables($(this)))})},prepareDisplayDependentComponents:function(e,t){console.log(e.type+" "+Date(e.timeStamp)),console.log(t),$('[data-mlab-type][data-mlab-displaydependent="true"]').each(function(){var e=$(this).data("mlab-type");void 0!==mlab.api.components[e]&&void 0!==mlab.api.components[e].onPageLoad&&mlab.api.components[e].onPageLoad($(this),mlab.api.getAllVariables($(this)))})},updateDisplay:function(e){(void 0===e?$("[data-mlab-size][data-mlab-aspectratio]"):$(e)).each(function(){var e=$('[data-role="page"]').first().innerWidth(),t=$(this).attr("data-mlab-aspectratio").split(":"),a=$(this).attr("data-mlab-size"),n=e*("small"==a?.33:"medium"==a?.67:1),i=n/t[0]*t[1];$(this).css({width:n+"px",height:i+"px"})})}},settings:{pageTextSizeToggle:function(e){$("."+e).hasClass("mlab_large_text")?$("."+e).removeClass("mlab_large_text"):$("."+e).addClass("mlab_large_text")},pageColorToggle:function(e,t){$("#"+e).hasClass("mlab_color_toggle")?($("#"+e).removeClass("mlab_color_toggle"),$("."+t).removeClass("mlab_color")):($("#"+e).addClass("mlab_color_toggle"),$("."+t).addClass("mlab_color"))}}},"undefined"==typeof mlab&&(mlab={api:null}),$(document).ready(function(){console.log("EVENT: ready"),"mlab_editor"!=$("body").attr("id")&&(console.log("STATE: mobile mode, init own object"),mlab.api=new Mlab_api,$(document).on("pagecreate","#index",function(e){console.log("EVENT: pagecreate-index")}),$(document).on("pagecreate",function(e){console.log("EVENT: pagecreate-general"),mlab.api.display.prepareRegularComponents(e),$("div.ui-page").on("swiperight",function(){mlab.api.navigation.pageDisplay("previous",!0),console.log("right swipe")}).on("swipeleft",function(){mlab.api.navigation.pageDisplay("next",!0),console.log("left swipe")})}),$(document).on("pagecontainershow",function(e,t){console.log("EVENT: pagecontainershow"),mlab.api.display.prepareDisplayDependentComponents(e,t),mlab.api.display.updateDisplay()}),$(window).on("orientationchange",function(e){console.log("EVENT: orientationchange"),mlab.api.display.updateDisplay()}),$(document).on("mlabready",function(){console.log("mlabready"),"undefined"!=typeof mlabInitialiseApp&&mlabInitialiseApp()}))});
function Mlab_dt_api(){this.storage=new Object,this.version=.9,this.properties_tooltip=!1}Mlab_dt_api.prototype={getUrlAppAbsolute:function(){return window.location.origin+this.parent.config.urls.app},getUrlAppRelative:function(){return this.parent.config.urls.app},getUrlComponentAbsolute:function(){return window.location.origin+this.parent.config.urls.component},getUrlComponentRelative:function(){return this.parent.config.urls.component},getUrlTemplateAbsolute:function(){return window.location.origin+this.parent.config.urls.template},getUrlTemplateRelative:function(){return this.parent.config.urls.template},getUrlUploadAbsolute:function(t){return window.location.origin+this.parent.urls.component_upload_file.replace("_APPID_",this.parent.app.id).replace("_COMPID_",t)},getUrlUploadRelative:function(t){return this.parent.urls.component_upload_file.replace("_APPID_",this.parent.app.id).replace("_FILETYPES_",t)},getStoragePluginList:function(t){var e,a=$("<ul></ul>"),n="",i=this,l=mlab.dt.api.getVariable(t,"storage_plugin");l&&l.name&&(e=l.name);for(type in this.parent.storage_plugins)n=type==e?" class='mlab_item_applied' data-mlab-selected-storage='true' ":"",a.append("<li data-mlab-storage-plugin-type='"+type+"' "+n+" title='"+$("<div/>").text(this.parent.storage_plugins[type]).html()+"'><img data-mlab-comp-tool='credentials' class='mlab_tools mlab_tools_space' src='/img/tools/credentials.png' title='qqq'><span>"+type.charAt(0).toUpperCase()+type.slice(1)+"</span></li>");return a.find("img").on("click",function(){var e=$(this).parent().data("mlab-storage-plugin-type"),a=$("[data-mlab-get-info='storage_plugins'] [data-mlab-storage-plugin-type='"+e+"']");i.getCredentials(a,e,i.parent.components[e].conf.credentials,i.parent.design.storage_plugin_store_credentials,!0,{storage_plugin_id:e,component:t})}),a.find("span").on("click",function(){mlab.dt.design.storage_plugin_setup($(this),$(this).parent().data("mlab-storage-plugin-type"),mlab.dt.api.getSelectedComponent())}),a},displayExternalHelpfile:function(t,e,a,n){var i="qtip-light mlab_dt_box_style mlab_zindex_top_tooltip",l=this.parent.urls.component_helpfile.replace("_COMPID_",t);void 0!==n&&(i=i+" "+n),$.getJSON(l,function(t){"SUCCESS"===t.result?$(a).qtip({solo:!1,content:{text:t.html,title:e,button:!0},position:{my:"topRight",at:"bottomMiddle",viewport:$(window),effect:!1},show:{ready:!0,modal:{on:!1}},hide:!1,style:{classes:i,tip:!0},events:{hide:function(t,e){e.destroy()}}}):alert(t.message)}).fail(function(){alert(_tr["mlab.dt.design.js.alert.help.notfound"])})},getMedia:function(file_type){var data=$.ajax({type:"GET",url:this.parent.urls.uploaded_files.replace("_APPID_",this.parent.app.id).replace("_FILETYPE_",file_type),async:!1}).responseText;return"success"==(data=eval("("+data+")")).result?data.files:"<option>"+_tr["mlab.dt.api.js.getMedia.fail"]+"</option>"},getStyle:function(t){for(i in t)switch(t[i]){case"text":"mc_text ";break;case"imgtxt":"mc_picture_and_text"}},indicateWait:function(t){t?$("#mlab_editor").addClass("mlab_loading_info"):$("#mlab_editor").removeClass("mlab_loading_info")},uploadMedia:function(t,e,a,n,i){function l(){n(t,$("#mlab_cp_select_file").val()),r.setDirty(),r.closeAllPropertyDialogs()}function o(e){n(t,e),r.setDirty(),r.closeAllPropertyDialogs()}var r=this,s=null,d=void 0!==i?i.currentTarget:t;s=this.properties_tooltip=$(d).qtip({solo:!1,content:{text:(content=$("<form />",{id:"mlab_dt_form_upload"}),content.append($("<p />",{class:"mlab_dt_text_info",text:_tr["mlab.dt.api.js.uploadMedia.qtip.content.1"]})),content.append($("<select />",{id:"mlab_cp_select_file",class:"mlab_dt_select"})),content.append($("<div />",{id:"mlab_cp_mediaupload_uploadfiles",class:"mlab_dt_picture mlab_dt_left"})),content.append($("<div />",{class:"mlab_dt_large_new_line",html:"&nbsp;"})),content.append($("<div />",{id:"mlab_cp_mediaupload_button_cancel",class:"mlab_dt_button_cancel mlab_dt_left",text:_tr["mlab.dt.api.js.uploadMedia.qtip.content.4"]})),content.append($("<div />",{id:"mlab_cp_mediaupload_button_ok",class:"mlab_dt_button_ok mlab_dt_left",text:_tr["mlab.dt.api.js.uploadMedia.qtip.content.5"]})),content),title:_tr["mlab.dt.api.js.uploadMedia.qtip.title"]},position:{my:"leftMiddle",at:"rightMiddle",viewport:$(window)},show:{ready:!0,modal:{on:!0,blur:!1}},hide:!1,style:{classes:"qtip-light mlab_zindex_top_tooltip",tip:!0},events:{render:function(i,d){r.indicateWait(!0),s=this,this.dt_component=t,this.dt_component_id=e.name,this.dt_config=e,this.dt_cb=n;var c=r.getMedia(a);$("#mlab_cp_select_file").html(c).on("change",l).ddslick({width:180,imagePosition:"left",selectText:"Select existing media file to use"});$("#mlab_cp_mediaupload_uploadfiles").uploadFile({url:r.getUrlUploadAbsolute(s.dt_config.name),formData:{comp_id:s.dt_component_id,app_path:r.parent.app.path},multiple:!1,dragDrop:!0,showCancel:!0,showAbort:!0,showDone:!0,autoSubmit:!1,fileName:"mlab_files",showStatusAfterSuccess:!0,onSuccess:function(t,e,a){"failure"==e.result?alert(e.msg):o(e.url)}.bind(s.dt_component),onError:function(t,e,a){alert(a)}});r.indicateWait(!1)},show:function(t,e){e.focus(t)},hide:function(t,e){e.destroy(),r.properties_tooltip=!1}}}),$("#mlab_cp_mediaupload_button_ok").on("click",function(t){uploadObj.startUpload()}.bind(s.dt_component)),$("#mlab_cp_mediaupload_button_cancel").on("click",function(t){api.hide(t)}.bind(s.dt_component))},getGUID:function(){return"mlab_"+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},getAllLibraries:function(){var t,e=[],a=this;$("#"+this.getEditorElement()).children("[data-mlab-type]").each(function(){t=$(this).data("mlab-type"),e.indexOf(t)<0&&(a.getLibraries(t),e.push(t))})},getScriptFiles:function(t,e,a){var n=t.shift(),i=this;$.ajaxSetup({cache:!0}),$.getScript(n).done(function(n,l){return t.length>0?i.getScriptFiles(t,e,a):($.ajaxSetup({cache:!1}),!0===e&&mlab.dt.design.component_add_html(a),!0)}).fail(function(t,e,a){return alert("Unable to load script: "+n+". Component not added, please check network connection"),$.ajaxSetup({cache:!1}),!1})},getLibraries:function(t,e){var a=[];if("required_libs"in this.parent.components[t].conf&&"designtime"in this.parent.components[t].conf.required_libs){var n=window.location.origin+this.parent.urls.components_root_url,l=this.parent.components[t].conf.name;for(i in this.parent.components[t].conf.required_libs.designtime){var o=this.parent.components[t].conf.required_libs.designtime[i];/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(o)?".js"==o.substr(-3)?$("script[src*='"+o+"']").length<1&&a.push(o):$("link[href*='"+o+"']").length<1&&$("head").append($("<link rel='stylesheet' type='text/css' href='"+o+"' >")):".js"==o.substr(-3)?a.push(n+l+"/js/"+o):".css"==o.substr(-4)&&$("link[href*='"+o+"']").length<1&&$("head").append($("<link rel='stylesheet' type='text/css' href='"+n+l+"/css/"+o+"' >"))}if(a.length>0)return void this.getScriptFiles(a,e,t)}!0===e&&mlab.dt.design.component_add_html(t)},getVersion:function(){return this.version},getSelectedComponent:function(){return $(".mlab_current_component")},setDirty:function(){this.parent.flag_dirty=!0},clearDirty:function(){this.parent.flag_dirty=!1},getEditorElement:function(){return this.parent.config.app.content_id},closeAllPropertyDialogs:function(){this.properties_tooltip&&$(this.properties_tooltip).qtip("hide")},executeCallback:function(t,e,a,n){void 0!==t&&null!=t&&t(e,a,n)},displayPropertyDialog:function(t,e,a,n,i,l,o,r,s){this.indicateWait(!0),this.closeAllPropertyDialogs(),that=this;var d="mlab_property_dlg qtip-light mlab_dt_box_style mlab_zindex_top_tooltip";if(1==r&&(d+=" mlab_dt_wide_qtip_box "),void 0!==s)c=s.currentTarget;else var c=t;var p="leftMiddle";$(".mlab_current_component").offset().top<=145&&(p="leftTop"),that.properties_tooltip=$(c).qtip({solo:!1,content:{text:a,title:e,button:!0},position:{my:p,at:"rightMiddle",viewport:$(window)},show:{ready:!0,modal:{on:!0,blur:!1},autofocus:o},hide:!1,style:{classes:d,tip:!0},events:{render:function(e,a){n&&that.executeCallback(n,t,e,a)},show:function(t,e){$(".qtip-title").append('<img class="mlab_dt_button_help" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiZCAAWNk5BICUAxAboEld+P3zxwYGcgHIYCBuAOL3QPwfB74PxAn4zGHE4+r9WFyNCywA+iYRmwQzFQwHAQNmFhaFf3//bESXYMKieD6JhsNAAtBxDsRY4IDDgAegoADiA3gsyScmch2wROx8NDUGuCKflBS0H6ppPw41+8m2AM03AljEDXAk2/cMlACgAQqg4MKTL+YTlQ9wGG4ATb4COJR8AGJDYH54QCgVkWu4I7rhRFsABP14DF8AdfkFoosKLD7AlToSgQYvILksItKCA0DDHQnpJTaIsHl/IsMoQI4DLLiBGL1MtHbcqAUEAQuR6hqxZTRiNAIEGADaemUuXgZoWQAAAABJRU5ErkJggg==">')},hide:function(e,a){l&&that.executeCallback(l,t,e,a),a.destroy(),that.properties_tooltip=!1},visible:function(e,a){i&&that.executeCallback(i,t,e,a)}}}),this.indicateWait(!1)},displayHtmlPageInDialog:function(t,e,a,n){i="qtip-light mlab_dt_box_style mlab_zindex_top_tooltip";if(void 0!==n)var i=i+" "+n;$(t).qtip({solo:!1,content:{text:a,title:e,button:!0},position:{my:"topRight",at:"bottomMiddle",viewport:$(window),effect:!1},show:{ready:!0,modal:{on:!1}},hide:!1,style:{classes:i,tip:!0},events:{hide:function(t,e){e.destroy()},render:function(){$(".mlab_help_icon").qtip().elements.tooltip.draggable()}}})},editContent:function(t){$(t).attr("contenteditable","true").focus();var e=document.createRange(),a=window.getSelection();e.selectNodeContents($(t)[0]),a.removeAllRanges(),a.addRange(e)},getLocale:function(){return this.parent.parent.locale},getLocaleComponentMessage:function(t,e){var a=this.getLocale(),n=this.parent.components[t].conf,l=!1;for(i in e){if(!(e[i]in n)){l=!1;break}l=!0,n=n[e[i]]}return l?"object"!=typeof n?n:a in n?n[a]:"default"in n?n.default:"":""},getVariable:function(t,e){var a=$(t).find("script.mlab_storage").html();if(void 0!==a&&""!=a){try{var n=JSON.parse(a)}catch(t){return void console.log(t)}return n[e]}},getAllVariables:function(t){var e=$(t).find("script.mlab_storage").html();if(void 0!==e&&""!=e){try{var a=JSON.parse(e)}catch(t){return void console.log(t)}return a}},getTempVariable:function(t,e){if(void 0!==document.mlab_dt_storage&&void 0!==document.mlab_dt_storage[t]&&void 0!==document.mlab_dt_storage[t][e])return document.mlab_dt_storage[t][e]},setVariable:function(t,e,a){var n=$(t).find("script.mlab_storage");if(n.length<1){$(t).append("<script type='application/json' class='mlab_storage' />");l=new Object}else{var i=n.html();if(""!=i)try{l=JSON.parse(i)}catch(t){console.log(t);l=new Object}else var l=new Object}return l[e]=a,$(t).find("script.mlab_storage").html(JSON.stringify(l)),this.setDirty(),!0},setAllVariables:function(t,e){return $(t).find("script.mlab_storage").length<1&&$(t).append("<script type='application/json' class='mlab_storage' />"),$(t).find("script.mlab_storage").html(JSON.stringify(e)),this.setDirty(),!0},setTempVariable:function(t,e,a){void 0===document.mlab_dt_storage&&(document.mlab_dt_storage={}),void 0===document.mlab_dt_storage[t]&&(document.mlab_dt_storage[t]={}),void 0===document.mlab_dt_storage[t][e]&&(document.mlab_dt_storage[t][e]={}),document.mlab_dt_storage[t][e]=a},setScript:function(t,e){var a=$(t).find("script.mlab_code");return a.length>0&&a.remove(),a=document.createElement("script"),a.type="text/javascript",a.className="mlab_code",a.text=e,$(t).append(a),!0},getSelTextParentLinkElement:function(){var t,e,a;if((e=window.getSelection()).rangeCount)for(a=(t=e.getRangeAt(0).commonAncestorContainer).nodeName.toLowerCase();"a"!=a&&"body"!=a;)a=(t=t.parentNode).nodeName.toLowerCase();return"a"==a&&t},checkSelTextValid:function(){var t,e;return""!=(e=window.getSelection()).toString()&&(t=e.getRangeAt(0).commonAncestorContainer,$(t).parents("div.mlab_current_component").length>0)},updateLink:function(t){var e,a=$("input:radio[name=mlab_dt_getlink_choice]:checked").val(),t="";if("page"==a){t=$("#mlab_dt_link_app_pages").val();var n=parseInt(t);if(!(parseInt(t)>=0&&n<1e3))return alert(_tr["mlab.dt.api.js.getLink.alert_no_page"]),!1;e=" onclick='mlab.api.navigation.pageDisplay(-1, "+n+"); return false;' "}else{if("url"!=a)return alert(_tr["mlab.dt.api.js.getLink.alert_choose_type"]),!1;if(t=$("#mlab_dt_link_app_url").val(),!/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(t))return alert(_tr["mlab.dt.api.js.getLink.alert_url_wrong"]),!1;e=t.trim()}return $(".mlab_current_component").find("a[href=MLAB_DT_LINK_TEMP]").attr("href",e),!0},setLink:function(t,e){if(this.checkSelTextValid()){document.execCommand("createlink",!1,"MLAB_DT_LINK_TEMP"),$(".mlab_current_component").find("a[href=MLAB_DT_LINK_TEMP]").addClass("mc_link mc_text").click(function(t){t.preventDefault()});var a="<option value='-1'></option>";for(page in mlab.dt.app.page_names)a=a+"<option value='"+page+"'>"+mlab.dt.app.page_names[page]+"</option>";var n=this,i=$('<div id="mlab_dt_link_dialog"><br><label class="mlab_dt_label"><input type="radio" name="mlab_dt_getlink_choice" value="page" class="mlab_dt_input">'+_tr["mlab.dt.api.js.getLink.app_page"]+'</label><br><select id="mlab_dt_link_app_pages" class="mlab_dt_select">'+a+'</select><br><label class="mlab_dt_label"><input type="radio" name="mlab_dt_getlink_choice" value="url" class="mlab_dt_input">'+_tr["mlab.dt.api.js.getLink.url"]+'</label><br><input type="text" id="mlab_dt_link_app_url" class="mlab_dt_input"><br></div>');i.append('<button class="mlab_dt_button_ok mlab_dt_right" onclick=" if (that.updateLink()) {mlab.dt.api.closeAllPropertyDialogs();}">'+_tr["mlab.dt.api.js.getLink.ok"]+"</button>"),i.append('<button class="mlab_dt_button_cancel mlab_dt_right" onclick=" that.cancelLink();">'+_tr["mlab.dt.api.js.getLink.cancel"]+"</button>");var l=_tr["mlab.dt.api.js.getLink.heading"];this.displayPropertyDialog(t,l,i,function(){$(".qtip-close").on("click",n.cancelLink)},null,null,null,!1,e)}else alert(_tr["mlab.dt.api.js.getLink.no_selection"])},cancelLink:function(){$(".mlab_current_component").find("a[href=MLAB_DT_LINK_TEMP]").replaceWith($(".mlab_current_component").find("a[href=MLAB_DT_LINK_TEMP]").contents()),mlab.dt.api.closeAllPropertyDialogs()},removeLink:function(){var t=this.getSelTextParentLinkElement();t&&$(t).parents("#mlab_editable_area").length>0&&$(t).replaceWith($(t).contents())},getCredentials:function(t,e,a,n,i,l){var o=mlab.dt.components[e].conf.credential_values,r=!1,s=this.getVariable(l.component,"storage_plugin");if(s&&(s=s.credentials),s)d=s;else if(o){for(credential in a)o[a[credential]]||(r=!0);d=o}else{r=!0;var d=new Array}if(r||i){var c=$("<div />",{id:"mlab_dt_dialog_credentials",title:_tr["mlab.dt.api.js.getCredentials.dlg.title"]});c.append($("<p />",{text:_tr["mlab.dt.api.js.getCredentials.dlg.text"],class:"mlab_dt_text_info"}));for(credential in a){var p=a[credential];c.append($("<label />",{text:p.charAt(0).toUpperCase()+p.slice(1),for:"mlab_dt_dialog_credentials_"+p,class:"mlab_dt_short_label"})),c.append($("<input />",{name:"mlab_dt_dialog_credentials_"+p,id:"mlab_dt_dialog_credentials_"+p,class:"mlab_dt_input",value:void 0===d[p]?"":d[p]}))}c.append($('<div class="mlab_dt_button_small_new_line">&nbsp;</div>')),c.append($('<button class="mlab_dt_button mlab_dt_right">'+_tr["mlab.dt.api.js.getCredentials.dlg.save"]+"</button>")),c.find("button").on("click",function(){var e={};for(credential in a)e[a[credential]]=$("#mlab_dt_dialog_credentials_"+a[credential]).val();t.qtip("hide"),n(e,l)}),this.displayPropertyDialog(t,_tr["mlab.dt.api.js.getCredentials.dlg.title"],c)}else n(d,l)},display:{setEditableFocus:function(t){var e=window.getSelection(),a=document.createRange(),n=t[0];""!=t.text()?(a.setStart(n,0),a.setEnd(n,0),e.removeAllRanges(),e.addRange(a)):(n.innerHTML="Â ",a.selectNodeContents(n),e.removeAllRanges(),e.addRange(a),document.execCommand("delete",!1,null))},setAspectRatio:function(t,e){if(["4:3","16:9","1:1"].indexOf(e)>-1){var a=$(t).children(":first");void 0===a.data("mlab-sizer")&&($(t).children().wrapAll("<div data-mlab-sizer='1' data-mlab-size='medium'></div>"),a=$(t).children(":first")),a.attr("data-mlab-aspectratio",e),this.parent.closeAllPropertyDialogs(),this.parent.setDirty(),this.updateDisplay(a)}},setSize:function(t,e){if(["small","medium","large","fullscreen"].indexOf(e)>-1){var a=$(t).children(":first");void 0===a.data("mlab-sizer")&&($(t).children().wrapAll("<div data-mlab-sizer='1' data-mlab-aspectratio='4:3'></div>"),a=$(t).children(":first")),$(a).attr("data-mlab-size",e),this.parent.closeAllPropertyDialogs(),this.parent.setDirty(),this.updateDisplay(a)}},updateDisplay:function(t){var e=this;(void 0===t?$("[data-mlab-sizer]"):$(t)).each(function(){var t=$('[data-mlab-sizer="1"]').parent().width(),a=$(this).attr("data-mlab-aspectratio").split(":"),n=$(this).attr("data-mlab-size"),i="small"==n?.33:"medium"==n?.67:1,l=$(this).parent().data("mlab-type"),o=t*i,r=o/a[0]*a[1];$(this).css({width:o+"px",height:r+"px"}),void 0!==e.parent.parent.components[l]&&void 0!==e.parent.parent.components[l].code&&void 0!==e.parent.parent.components[l].code.onResize&&e.parent.parent.components[l].code.onResize(this)})},invertColor:function(t){if(void 0===t)return"rgb(255, 255, 255);";var e,a=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);for(a.splice(0,1),e=1;e<3;++e)a[e]=parseInt(a[e],10);var n="rgb(";return $.each(a,function(t,e){n+=255-e+","}),n=n.slice(0,-1),n+=")"},getBackground:function(t){var e=t.css("background-color");return"rgba(0, 0, 0, 0)"!==e?e:!t.is("body")&&this.getBackground(t.parent())},componentHighlightSelected:function(t){var e=$("#"+this.parent.getEditorElement()+"> div.mlab_current_component");if(t[0]===e[0])return!1;if(t[0]!==e[0]){e.qtip("hide"),e.removeClass("mlab_current_component"),e.find("mlab_current_component").css("outline-color","").removeClass("mlab_current_component"),e.find(".mlab_current_component_editable").css("outline-color","").removeClass("mlab_current_component_editable").attr("contenteditable",!1),window.getSelection().removeAllRanges(),e.find(".mlab_current_component_child").css("outline-color","").removeClass("mlab_current_component_child");var a=$("[data-role=page]").css("background-color"),n=this.invertColor(a);return $(t).css("outline-color",n),$(t).addClass("mlab_current_component"),!0}return!1},componentHighlightSelectedChildren:function(t,e,a){if(t=$(t),!$(".mlab_current_component").find(".mlab_current_component_child").is(t)||a){$(".mlab_current_component").find(".mlab_current_component_child").css("outline-color","").removeClass("mlab_current_component_child");var n=this.getBackground(t),i=this.invertColor(n);t.css("outline-color",i),t.addClass("mlab_current_component_child")}if(void 0!==e&&(e=$(e),!$(".mlab_current_component").find(".mlab_current_component_editable").is(e)&&($(".mlab_current_component").find(".mlab_current_component_editable").css("outline-color","").removeClass("mlab_current_component_editable").attr("contenteditable",!1),void 0!==e&&e.length>0&&"input"!=$(e).prop("tagName").toLowerCase()))){var l=this.getBackground(e),o=this.invertColor(l);e.css("outline-color",o),e.addClass("mlab_current_component_editable").attr("contenteditable",!0)}}}};
function Mlab_dt_management(){this.parent=null}Mlab_dt_management.prototype={app_open:function(e,t){var a=t,p=this.parent.urls.app_open.replace("_ID_",e);p=(p=(p=p.replace("_PAGE_NUM_","index")).replace("_UID_",this.parent.uid)).replace("_OPEN_MODE_","true"),this.parent.utils.update_status("callback",_tr["mlab.dt.management.js.update_status.opening.app"],!0);var n=this;$.get(p,function(e){if("success"==e.result){if(n.index_page_process(e.html,"index","0"==a||"index"==a||1==n.parent.app.page_names.length),mlab.dt.app.compiled_files=e.compiled_files,$.each(mlab.dt.config.compiler_service.supported_platforms,function(e,t){if(void 0!==mlab.dt.app.compiled_files[t]){var a=document.getElementsByTagName("base")[0].href.slice(0,-1)+"_compiled/"+mlab.dt.app.compiled_files[t];$("#mlab_download_qr_link_"+t).empty().qrcode({text:a,size:150,background:"#ffffff",foreground:"#000000",render:"table"}),$("#mlab_download_link_"+t).html("<b>URL</b>:</br>"+a)}}),$("#mlab_statusbar_permanent").html(mlab.dt.app.name),$("#mlab_features_list li").removeClass("mlab_item_applied"),$(n.parent.app.curr_indexpage_html).find("#mlab_features_content [data-mlab-type]>").each(function(){$("#mlab_features_list [data-mlab-feature-type='"+$(this).parent().data("mlab-type")+"']").addClass("mlab_item_applied")}),e.only_index&&0==$("#"+n.parent.config.app.content_id).children().length){var t=prompt(_tr["mlab.dt.management.js.prompt.title.front.page"],n.parent.app.curr_pagetitle);null!=t&&(n.parent.app.curr_pagetitle=t,$("#mlab_page_control_title").text(n.parent.app.curr_pagetitle),n.parent.flag_dirty=!0)}"0"==a||"index"==a||e.only_index?("locked"==e.lock_status?(n.parent.app.locked=!0,$("#"+n.parent.config.app.content_id).fadeTo("slow",.6),$("div.container").append('<div id="mlab_editor_disabled" style="background-color: gray; position: absolute;top:110px;left:0;width: 100%;height:100%;z-index:2;opacity:0.4;filter: alpha(opacity = 50); background-image: url(/img/page_locked.png); background-repeat: no-repeat; background-position: 95% 2%;"></div>')):(n.parent.app.locked=!1,$("#mlab_editor_disabled").remove(),$("#"+n.parent.config.app.content_id).fadeTo("slow",1)),n.parent.utils.update_status("temporary",_tr["mlab.dt.management.js.update_status.ready"],!1),$("#mlab_overlay").slideUp(),n.parent.app.locked="locked"==e.lock_status,n.parent.utils.timer_start()):n.page_open_process(e.app_id,a)}else n.parent.utils.update_status("temporary",e.msg,!1);$("#"+mlab.dt.config.app.content_id).on("paste",function(e){e.preventDefault();var t=$(".mlab_current_component").data("mlab-type");if(void 0!==mlab.dt.components[t].conf.paste_allowed&&!1!==mlab.dt.components[t].conf.paste_allowed){var a=e.originalEvent.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,a),$(".mlab_editor_footer_help").text(_tr["build_app.footer.help.paste.text"]),setTimeout(function(){$(".mlab_editor_footer_help").text("")},5e3),mlab.dt.flag_dirty=!0}})})},app_download:function(){that=this,this.page_save(function(){that.app_download_process()})},app_download_process:function(){this.parent.utils.update_status("callback",_tr["mlab.dt.management.js.update_status.retrieving.app"],!0);var e=this.parent.urls.app_download.replace("_ID_",this.parent.app.id),t=this;$.get(e,function(e){t.parent.utils.update_status("completed"),"success"==e.result?(full_url=window.location.origin+e.url,$("#mlab_download_qr2").empty().qrcode({text:full_url,render:"table"}).show().append("<br>").append("<a href='"+full_url+"'>"+_tr["mlab.dt.management.js.app_download_process.1"]+": "+full_url+"</a>").append("<br>").append("<a href='mailto:"+t.parent.user_email+"?subject=Link&body="+_tr["mlab.dt.management.js.app_download_process.2"]+": "+encodeURI(full_url)+"'>"+_tr["mlab.dt.management.js.app_download_process.3"]+"</a>")):$("#mlab_download_qr2").empty().append("<p>"+_tr["mlab.dt.management.js.app_download_process.4"]+": "+e.msg+"</p>").show()}),t.parent.utils.timer_start()},app_submit_to_market:function(){alert(_tr["mlab.dt.management.js.app_submit_to_market"])},app_remove_locks:function(){this.parent.utils.update_status("temporary",_tr["mlab.dt.management.js.update_status.unlocking.pages"],!0),$.get(this.parent.urls.app_unlock),$("#"+this.parent.config.app.content_id).fadeTo("slow",1),$("#mlab_editor_disabled").remove(),this.parent.app.locked=!1},app_update_gui_metadata:function(){var e=$("<ol></ol>"),t=this.parent.app.curr_page_num,a="";"index"==t&&(t=0);for(i in this.parent.app.page_names)i>0&&(a="<span class='mlab_copy_file' title='"+_tr["mlab.dt.management.js.app_update_gui_metadata.copy.pages"]+" "+i+"' onclick='mlab.dt.management.page_copy(\""+i+"\");' >&nbsp;</span>"),0==i&&(a="<span class='mlab_not_copy_file'>&nbsp;</span>"),i==t?e.append("<li data-mlab-page-num='"+i+"' data-mlab-page-open='"+i+"'>"+a+this.parent.app.page_names[i]+"</li>"):e.append("<li data-mlab-page-num='"+i+"'>"+a+"<a data-mlab-page-open='"+i+"' href='javascript:mlab.dt.management.page_open("+this.parent.app.id+', "'+i+"\");'>"+this.parent.app.page_names[i]+"</a></li>");$("#mlab_existing_pages").html(e),$("#mlab_existing_pages ol").sortable({items:"> li:gt(0)",update:function(e,t){mlab.dt.management.page_reorder(e,t)}}).disableSelection(),$("#mlab_edit_app_title").text(this.parent.app.name),$("#mlab_edit_app_description").text(this.parent.app.description),$("#mlab_edit_app_keywords").text(this.parent.app.keywords),$("#mlab_edit_app_category1").text(this.parent.app.categoryOne),$("#mlab_edit_app_category2").text(this.parent.app.categoryTwo),$("#mlab_edit_app_category3").text(this.parent.app.categoryThree)},index_page_process:function(e,t,a){var p,n="",r=this.parent.config.urls.app+this.parent.app.path+"/"+this.parent.app.active_version+"/",i=(new DOMParser).parseFromString(e,"text/html");if(null!=i.getElementById(this.parent.config.app.content_id)){document.getElementsByTagName("base")[0].href=r,$("#mlab_editor_chrome").empty(),$("link[rel=stylesheet][href^='css']").remove();for(var s=i.getElementsByTagName("head")[0],l=i.getElementById(this.parent.config.app.content_id).cloneNode(!0).childNodes,o=i.getElementById(this.parent.config.app.content_id);o.firstChild;)o.removeChild(o.firstChild);for(var _=i.getElementsByTagName("body")[0].cloneNode(!0),m=s.getElementsByTagName("link"),c=0;c<m.length;c++)(p=m[c].getAttribute("href")).indexOf("style_rt.css")<0&&(n=n+"<link rel='stylesheet' href='"+p+"' type='text/css'>\n");$("head link[rel='stylesheet']").last().after(n),$("#mlab_editor_chrome").append(_.innerHTML),a&&($("#"+this.parent.config.app.content_id).html(l),this.parent.api.getAllLibraries(),this.parent.design.prepare_editable_area()),this.parent.app.curr_indexpage_html=i,this.parent.app.curr_pagetitle=s.getElementsByTagName("title")[0].innerText,this.parent.app.curr_page_num=t,$("#mlab_page_control_title").text(this.parent.app.curr_pagetitle),this.app_update_gui_metadata();try{$.mobile.initializePage()}catch(e){console.log(e.message)}mlab.dt.api.display.updateDisplay();var d=2*parseInt($("#mlab_editor_chrome").css("margin-bottom"))+parseInt($("#mlab_editor_chrome").css("border-bottom-width"));$("[data-role=header]").css({position:"absolute","z-index":0}),$("[data-role=footer]").css({position:"absolute",bottom:$("[data-role=footer]").height()+d+"px"}),$("[data-role=page]").css({width:"100%",height:"100%","min-height":"",position:"absolute",margin:"0",padding:"0","padding-top":$("[data-role=header]").height()+"px","padding-bottom":$("[data-role=footer]").height()+"px"}),$("#panel_left").css("background-image",$("#panel_left").css("background-image")),$("#panel_right").css("background-image",$("#panel_right").css("background-image"))}else alert(_tr["mlab.dt.management.js.index_page_process.alert.1"]+" "+this.parent.config.app.content_id+", "+_tr["mlab.dt.management.js.index_page_process.alert.2"])},regular_page_process:function(e,t){this.parent.config.urls.app,this.parent.app.path,this.parent.app.active_version;$("#"+this.parent.config.app.content_id).html(""),""==e&&(e=(e=this.parent.config.app.html_header.replace("%TITLE%","Title")+this.parent.config.app.html_footer).replace(/\\n/g,"\n"));var a=(new DOMParser).parseFromString(e,"text/html"),p=a.getElementsByTagName("head")[0],n=a.getElementsByClassName("mlab_main_body_content")[0].cloneNode(!0);this.parent.app.curr_pagetitle=p.getElementsByTagName("title")[0].innerText,this.parent.app.curr_page_num=t,$("#mlab_page_control_title").text(this.parent.app.curr_pagetitle),this.app_update_gui_metadata(),$("#"+this.parent.config.app.content_id).html(n.innerHTML),this.parent.api.getAllLibraries(),this.parent.design.prepare_editable_area();try{$.mobile.initializePage()}catch(e){console.log(e.message)}mlab.dt.api.display.updateDisplay()},page_move_to:function(e){var t=0;if(t="index"==this.parent.app.curr_page_num?0:parseInt(this.parent.app.curr_page_num),e<0&&t>0)t--;else{if(!(e>0))return;t++}this.page_open(this.parent.app.id,t)},page_reorder:function(e,t){t.item.find("a").data("mlab-page-open")!=t.item.index()?(that=this,this.page_save(function(){mlab.dt.utils.timer_stop(),that.page_reorder_process(e,t)})):console.log("not moved")},page_reorder_process:function(e,t){var a=this.parent.app.id,p=t.item.data("mlab-page-num"),n=t.item.index(),r=this,i=this.parent.urls.page_reorder.replace("_ID_",a);i=(i=(i=i.replace("_FROM_PAGE_",p)).replace("_TO_PAGE_",n)).replace("_UID_",this.parent.uid),this.parent.utils.update_status("callback",_tr["mlab.dt.management.js.update_status.reordering.page"],!0),$.get(i,function(e){r.parent.utils.update_status("completed"),"success"==e.result?(r.parent.app.page_names=e.page_names,r.parent.app.curr_page_num=e.to_page):alert("Unable to move page"),r.app_update_gui_metadata(),mlab.dt.utils.timer_start()})},page_open:function(e,t){that=this,this.page_save(function(){that.page_open_process(e,t)})},page_open_process:function(e,t){this.parent.utils.update_status("callback",_tr["mlab.dt.management.js.update_status.opening.page"],!0);var a=this.parent.urls.page_get.replace("_ID_",e);a=(a=a.replace("_PAGE_NUM_",t)).replace("_UID_",this.parent.uid),void 0!==this.parent.qtip_tools&&($(this.parent.qtip_tools).qtip("hide"),this.parent.qtip_tools=void 0,void 0!==this.parent.api.properties_tooltip&&($(this.parent.api.properties_tooltip).qtip("hide"),this.parent.api.properties_tooltip=void 0));var p=this;$.get(a,function(e){if("success"==e.result){if(p.parent.utils.update_status("completed"),p.parent.utils.update_status("permanent",p.parent.app.name),$("#mlab_page_control_title").text(p.parent.app.curr_pagetitle),0==e.page_num_sent||"index"==e.page_num_sent)p.index_page_process(e.html,"index",!0),$(".mlab_current_component").find("a[href=MLAB_DT_LINK_TEMP]").click(function(e){e.preventDefault()});else{if("last"==e.page_num_sent&&0==e.page_num_real)return p.parent.utils.timer_start(),void($("#mlab_overlay").is(":visible")&&$("#mlab_overlay").slideUp());p.regular_page_process(e.html,e.page_num_real);var t=window.location.pathname.split("/");t[t.length-3]=e.app_id,t[t.length-2]=e.page_num_real,history.pushState({id:e.app_id,page:e.page_num_real},p.parent.app.curr_pagetitle,t.join("/"))}"locked"==e.lock_status?(p.parent.app.locked=!0,$("#"+p.parent.config.app.content_id).fadeTo("slow",.6),$("div.container").append('<div id="mlab_editor_disabled" style="background-color: gray; position: absolute;top:110px;left:0;width: 100%;height:100%;z-index:2;opacity:0.4;filter: alpha(opacity = 50); background-image: url(/img/page_locked.png); background-repeat: no-repeat; background-position: 95% 2%;"></div>')):(p.parent.app.locked=!1,$("#mlab_editor_disabled").remove(),$("#"+p.parent.config.app.content_id).fadeTo("slow",1)),$("#mlab_overlay").is(":visible")&&$("#mlab_overlay").slideUp(),$("#mlab_editable_area").find("a").click(function(e){e.preventDefault()}),p.parent.utils.timer_start()}else p.parent.utils.update_status("temporary",e.msg,!1)})},file_import:function(){that=this,this.page_save(function(){that.file_import_process()})},file_import_process:function(){this.parent.utils.update_status("callback",_tr["mlab.dt.management.js.update_status.importing.file"],!0);var e=$("#mlab_form_import_file")[0],t=new FormData(e);$.ajax({url:this.parent.urls.file_import,data:t,type:"POST",contentType:!1,processData:!1,success:function(e){that.parent.utils.update_status("completed"),console.log("Status returned: "+e.app_status),"success"==e.result&&(mlab.dt.utils.update_status("temporary","",!1),that.parent.app.page_names=data.page_names,that.app_update_gui_metadata())}})},page_update_title:function(){if(this.parent.app.locked)alert(_tr["mlab.dt.management.js.page_update_title.alert.page.locked"]);else{if("index"==this.parent.app.curr_page_num)e=0;else var e=this.parent.app.curr_page_num;this.parent.flag_dirty=!0,this.parent.app.curr_pagetitle=$("#mlab_page_control_title").text(),this.parent.app.page_names[this.parent.app.curr_page_num]=this.parent.app.curr_pagetitle,$("#mlab_page_control_title").text(this.parent.app.curr_pagetitle),$("#mlab_existing_pages [data-mlab-page-open='"+e+"']").html("<span class='mlab_copy_file' onclick='this.page_copy(\""+e+"\");' >&nbsp;</span>"+this.parent.app.curr_pagetitle)}},page_save:function(e,t){this.parent.utils.timer_stop();var a=!0,p=!1;if(this.parent.counter_saving_page++,$("#mlab_editor_disabled").length>0&&(console.log("Page locked, did not save"),a=!1),void 0!==this.parent.app.curr_page_num&&void 0!==this.parent.app.id||(a=!1),this.parent.flag_dirty||void 0!==t||(a=!1),!a&&void 0!==e)return e();if(!a)return this.parent.utils.timer_start(),!1;this.parent.utils.update_status("callback",_tr["mlab.dt.management.js.update_status.storing.page"],!0);var n=$("#"+this.parent.config.app.content_id+" .mlab_current_component");n.removeClass("mlab_current_component");var r=this.parent.app.id,i=this.parent.app.curr_page_num,s="",l=new Object,o=new Array,_=this.parent.urls.page_save.replace("_ID_",r);_=(_=_.replace("_PAGE_NUM_",i)).replace("_CHECKSUM_",this.parent.app.app_checksum);d=this;if($("#"+d.parent.config.app.content_id).children("div").each(function(){var e=$(this).data("mlab-type");void 0!==d.parent.components[e].code&&void 0!==d.parent.components[e].code.onSave?s+=d.parent.components[e].code.onSave(this):s=s+$(this)[0].outerHTML+"\n",d.parent.bestpractice.component_check_content(this,e,l,o)}),this.parent.bestpractice.page_check_content(l,o),0==i||"index"==i){var m=this.parent.app.curr_indexpage_html;m.getElementById(this.parent.config.app.content_id).innerHTML=s,m.title=this.parent.app.curr_pagetitle;c=(new XMLSerializer).serializeToString(m)}else var c=s;n.addClass("mlab_current_component");var d=this;return $.post(_,{title:this.parent.app.curr_pagetitle,html:c},function(t){if(d.parent.counter_saving_page--,"success"==t.result){if(d.parent.utils.update_status("temporary",_tr["mlab.dt.management.js.update_status.saved.page"],!1),d.parent.flag_dirty=!1,void 0!==e&&(p=e()),void 0!==t.app_info){if("file_changes"===t.app_info.result)console.log("App files were changed"),d.parent.app.app_checksum=t.app_info.mlab_app_checksum,d.parent.app.page_names=t.app_info.mlab_app.page_names;else{if("no_file_changes"!==t.app_info.result)return void(0==d.parent.counter_saving_page&&void 0===e&&d.parent.utils.timer_start());console.log("No changes to app files")}d.parent.app.name=t.app_info.mlab_app.name,d.parent.app.description=t.app_info.mlab_app.description,d.parent.app.keywords=t.app_info.mlab_app.keywords,d.parent.app.categoryOne=t.app_info.mlab_app.categoryOne,d.parent.app.categoryTwo=t.app_info.mlab_app.categoryTwo,d.parent.app.categoryThree=t.app_info.mlab_app.categoryThree,d.app_update_gui_metadata()}}else if(d.parent.utils.update_status("temporary",_tr["mlab.dt.management.js.update_status.unable.save.page"]+": "+t.msg,!1),void 0!==e)return $("#mlab_dialog_confirm").dialog({resizable:!1,height:140,modal:!0,buttons:{Retry:function(){$(this).dialog("close"),d.page_save(e)},Continue:function(){$(this).dialog("close"),p=e()},Cancel:function(){$(this).dialog("close")}}}),p;0==d.parent.counter_saving_page&&void 0===e&&d.parent.utils.timer_start()}),o.length>0?($("#mlab_statusbar_permanent").qtip({content:{text:"<ul><li>"+o.join("</li><li>")+"</li></ul>"},position:{my:"topMiddle",at:"bottomMiddle",viewport:$(window)},show:{ready:!0},hide:{event:"unfocus"},style:{"background-color":"white",color:"blue",classes:"mlab_qtip_info",tip:!0}}),window.setTimeout(function(){$(".mlab_qtip_info").remove()},5e3)):$(".mlab_qtip_info").remove(),p},page_new:function(){var e=prompt(_tr["mlab.dt.management.js.page_new.prompt.title.new.page"]);null!=e&&(that=this,this.page_save(function(){that.page_new_process(e)}))},page_new_process:function(e){$("body").css("cursor","wait"),this.parent.utils.update_status("callback",_tr["mlab.dt.management.js.update_status.storing.page"],!0);var t=this.parent.urls.page_new.replace("_ID_",this.parent.app.id);t=t.replace("_UID_",this.parent.uid),void 0!==this.parent.qtip_tools&&($(this.parent.qtip_tools).qtip("hide"),this.parent.qtip_tools=void 0,void 0!==this.parent.api.properties_tooltip&&($(this.parent.api.properties_tooltip).qtip("hide"),this.parent.api.properties_tooltip=void 0));var a=this;$.post(t,{},function(t){"success"==t.result?(a.parent.utils.update_status("completed"),$("#"+a.parent.config.app.content_id).empty(),a.parent.app.curr_pagetitle=e,a.parent.app.curr_page_num=t.page_num_real,$("#mlab_page_control_title").text(a.parent.app.curr_pagetitle),a.parent.app.page_names[a.parent.app.curr_page_num]=e,a.app_update_gui_metadata(),a.parent.flag_dirty=!0,$("body").css("cursor","default")):(a.parent.utils.update_status("temporary",t.msg,!1),$("body").css("cursor","default")),a.parent.utils.timer_start()})},page_copy:function(e){"0"!=e&&"index"!=e?(that=this,this.page_save(function(){that.page_copy_process(e)})):alert(_tr["mlab.dt.management.js.page_copy.alert.not.copy.index.page"])},page_copy_process:function(e){var t=this.parent.urls.page_copy.replace("_ID_",this.parent.app.id);t=(t=t.replace("_PAGE_NUM_",e)).replace("_UID_",this.parent.uid),this.parent.utils.update_status("callback",_tr["mlab.dt.management.js.update_status.copying.page"],!0);var a=this;$.get(t,function(e){a.parent.utils.update_status("completed"),"success"==e.result?(a.parent.app.curr_pagetitle=e.page_title,$("#mlab_page_control_title").text(e.page_title),a.parent.app.page_names[e.page_num_real]=e.page_title,a.regular_page_process(e.html,e.page_num_real)):alert(e.msg),a.parent.utils.timer_start()})},page_delete:function(){if("0"!=this.parent.app.curr_page_num&&"index"!=this.parent.app.curr_page_num){if(confirm(_tr["mlab.dt.management.js.page_copy.alert.sure.delete"])){this.parent.utils.timer_stop(),this.parent.utils.update_status("callback",_tr["mlab.dt.management.js.update_status.deleting.page"],!0);var e=this.parent.urls.page_delete.replace("_ID_",this.parent.app.id);e=(e=e.replace("_PAGE_NUM_",this.parent.app.curr_page_num)).replace("_UID_",this.parent.uid);var t=this;$.get(e,function(e){t.parent.utils.update_status("completed"),"success"==e.result?($("#mlab_existing_pages [data-mlab-page-open='"+t.parent.app.curr_page_num+"']").remove(),t.parent.app.page_names.splice(t.parent.app.curr_page_num,1),t.regular_page_process(e.html,e.page_num_real),"index"==t.parent.app.curr_page_num?$("#mlab_existing_pages [data-mlab-page-open='"+t.parent.app.curr_page_num+"']").html(t.parent.app.curr_pagetitle):$("#mlab_existing_pages [data-mlab-page-open='"+t.parent.app.curr_page_num+"']").html("<span class='mlab_copy_file' onclick='mlab.dt.management.page_copy(\""+t.parent.app.curr_page_num+"\");' >&nbsp;</span>"+t.parent.app.curr_pagetitle)):t.parent.utils.update_status("temporary",e.msg,!1),t.parent.utils.timer_start()})}}else alert(_tr["mlab.dt.management.js.page_copy.alert.not.delete.index.page"])},page_preview:function(){that=this,this.page_save(function(){that.page_preview_process()})},page_preview_process:function(){var e=this.parent.urls.app_preview.replace("_APPID_",this.parent.app.id),t=.25*$(window).width(),a=.75*$(window).height();void 0==window.open(e,"targetWindow","toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width="+t+",height="+a+",left="+t)&&alert(_tr["mlab.dt.management.js.page_preview_process.alert.cannot.open.new.window"])},socket:{connection:null,setup:function(e,t){mlab.dt.management.socket.connection&&mlab.dt.management.socket.connection.close(),mlab.dt.management.socket.connection=new WebSocket(mlab.dt.config.ws_socket.url_client+mlab.dt.config.ws_socket.path_client+"/"+mlab.dt.uid),mlab.dt.management.socket.connection.onerror=function(e){console.log("The following error occurred: "+e.data),mlab.dt.management.socket.connection=null,alert(_tr["mlab.dt.management.js.websocket.error.connect"])},mlab.dt.management.socket.connection.onopen=function(){console.log("onopen"),e(t)},mlab.dt.management.socket.connection.onmessage=function(e){switch(data=JSON.parse(e.data),data.status){case"connected":$("#mlab_progressbar").val(5),$("#mlab_statusbar_compiler").text(_tr["mlab_editor.init.js.compiling.connected"]);break;case"creating":$("#mlab_progressbar").val(10),$("#mlab_statusbar_compiler").text(_tr["mlab_editor.init.js.compiling.creating"]);break;case"created":$("#mlab_progressbar").val(15),$("#mlab_statusbar_compiler").text(_tr["mlab_editor.init.js.compiling.created"]);break;case"precompilation":$("#mlab_progressbar").val(20),$("#mlab_statusbar_compiler").text(_tr["mlab_editor.init.js.compiling.precompilation"]);break;case"uploading":$("#mlab_progressbar").val(25),$("#mlab_statusbar_compiler").text(_tr["mlab_editor.init.js.compiling.uploading"]);break;case"verifying":$("#mlab_progressbar").val(30),$("#mlab_statusbar_compiler").text(_tr["mlab_editor.init.js.compiling.verifying"]);break;case"verification_ok":$("#mlab_progressbar").val(35),$("#mlab_statusbar_compiler").text(_tr["mlab_editor.init.js.compiling.verification_ok"]);break;case"compiling":$("#mlab_progressbar").val(40),$("#mlab_statusbar_compiler").text(_tr["mlab_editor.init.js.compiling.compiling"]);break;case"compilation_ok":$("#mlab_progressbar").val(80),$("#mlab_statusbar_compiler").text(_tr["mlab_editor.init.js.compiling.compilation_ok"]);break;case"failed":case"precompilation_failed":case"compilation_failed":case"verification_failed":case"create_failed":$("#mlab_statusbar_compiler").text(""),$("#mlab_download_"+data.platform+"_icon").removeClass("mlab_download_"+data.platform+"_icon_grey"),$("#mlab_download_"+data.platform+"_icon").find("img").hide(),$("#mlab_progressbar").hide(),mlab.dt.utils.update_status("temporary",data.fail_text,!1),mlab.dt.management.socket.connection.close(),mlab.dt.management.socket.connection=null;break;case"receiving":$("#mlab_progressbar").val(90),$("#mlab_statusbar_compiler").text(_tr["mlab_editor.init.js.compiling.receiving"]);break;case"ready":if($("#mlab_progressbar").val(100),$("#mlab_statusbar_compiler").text(""),$("#mlab_download_"+data.platform+"_icon").removeClass("mlab_download_"+data.platform+"_icon_grey"),$("#mlab_download_"+data.platform+"_icon").find("img").hide(),$("#mlab_progressbar").hide(),void 0!==data.filename&&null!=data.filename&&""!=data.filename){mlab.dt.app.compiled_files[data.platform]=data.filename;var t=document.getElementsByTagName("base")[0].href.slice(0,-1)+"_compiled/"+data.filename;$("#mlab_download_qr_link_"+data.platform).empty().qrcode({text:t,size:150,background:"#ffffff",foreground:"#000000",render:"table"}),$("#mlab_download_link_"+data.platform).html("<b>URL</b>:</br>"+t),mlab.dt.utils.update_status("temporary",_tr["mlab_editor.init.js.compiling.ready"],!1)}else mlab.dt.utils.update_status("temporary",_tr["mlab_editor.init.js.compiling.failed"],!1);mlab.dt.management.socket.connection.close(),mlab.dt.management.socket.connection=null}}}},market:{login:function(){},submit_app_details:function(){},upload_app_file:function(){},publish_app:function(){},unpublish_app:function(){}},compiler:{get_app_status:function(){var e=mlab.dt.urls.cmp_get_app_status.replace("_WINDOW_UID_",mlab.dt.uid),t=prompt(_tr["mlab.dt.management.js.compiler.get_app_status.prompt.db.id"]);e=e.replace("/_ID_",null!=t&&""!=t?"/"+t:"");var a=prompt(_tr["mlab.dt.management.js.compiler.get_app_status.prompt.version"]);e=e.replace("/_VERSION_",null!=a&&""!=a?"/"+a:"");var p=prompt(_tr["mlab.dt.management.js.compiler.get_app_status.prompt.platform"]);e=e.replace("/_PLATFORM_",null!=p&&""!=p?"/"+p:""),$(document).ajaxError(function(e,t,a){0===t.status?alert("Not connect.\n Verify Network."):404==t.status?alert("Requested page not found. [404]"):500==t.status?alert("Internal Server Error [500]."):alert("Uncaught Error.\n"+t.responseText),mlab.dt.utils.update_status("temporary",t.responseText,!1)}),$.ajax({url:e,dataType:"json",success:function(e){"success"==e.result?(console.log("Status returned: "),console.log(e.app_status)):(alert(_tr["mlab.dt.management.js.compiler.get_app_status.alert.unable.get.app.status"]),mlab.dt.utils.update_status("temporary","",!1))}})},get_app_source:function(){var e=mlab.dt.urls.cmp_get_app_source.replace("_WINDOW_UID_",mlab.dt.uid);e=(e=e.replace("_ID_",mlab.dt.app.id)).replace("_VERSION_",mlab.dt.app.active_version),$(document).ajaxError(function(e,t,a){0===t.status?alert("Not connect.\n Verify Network."):404==t.status?alert("Requested page not found. [404]"):500==t.status?alert("Internal Server Error [500]."):alert("Uncaught Error.\n"+t.responseText),mlab.dt.utils.update_status("temporary",t.responseText,!1)}),$.ajax({url:e,dataType:"json",success:function(e){if("success"==e.result)$("<iframe/>").attr({src:e.url,style:"visibility:hidden;display:none"}).appendTo("body");else alert(_tr["mlab.dt.management.js.compiler.get_app_status.alert.unable.get.app.status"]),mlab.dt.utils.update_status("temporary","",!1)}})},upload_website:function(){var e=mlab.dt.urls.cmp_upload_website.replace("_WINDOW_UID_",mlab.dt.uid);e=(e=e.replace("_ID_",mlab.dt.app.id)).replace("_VERSION_",mlab.dt.app.active_version),$(document).ajaxError(function(e,t,a){0===t.status?alert("Not connect.\n Verify Network."):404==t.status?alert("Requested page not found. [404]"):500==t.status?alert("Internal Server Error [500]."):alert("Uncaught Error.\n"+t.responseText),mlab.dt.utils.update_status("temporary",t.responseText,!1)}),$.ajax({url:e,dataType:"json",success:function(e){"success"==e.result?(console.log("Status returned: "),console.log(e.app_status)):(alert(_tr["mlab.dt.management.js.compiler.get_app_status.alert.unable.get.app.status"]),mlab.dt.utils.update_status("temporary","",!1))}})},get_app:function(e){mlab.dt.management.socket.setup(mlab.dt.management.compiler.get_app_callback,e)},get_app_callback:function(e){var t=mlab.dt.urls.cmp_get_app_process.replace("_WINDOW_UID_",mlab.dt.uid);t=(t=(t=t.replace("_ID_",mlab.dt.app.id)).replace("_VERSION_",mlab.dt.app.active_version)).replace("_PLATFORM_",e);var a=_tr["mlab.dt.management.js.compiler.get_app.status.creating.app"];$("#mlab_statusbar_compiler").text(a),$("#mlab_download_"+e+"_icon").find("img").show(),$("#mlab_download_"+e+"_icon").addClass("mlab_download_"+e+"_icon_grey"),$("#mlab_progressbar").show(),$("#mlab_progressbar").val(2),$.getJSON(t,function(t){"success"!=t.result&&($("#mlab_statusbar_compiler").text(""),$("#mlab_progressbar").hide(),mlab.dt.utils.update_status("temporary",_tr["mlab.dt.management.js.update_status.unable.contact.server"],!1),$("#mlab_download_"+e+"_icon").find("img").hide(),$("#mlab_download_"+e+"_icon").removeClass("mlab_download_"+e+"_icon_grey"))})}}};
function Mlab_dt_bestpractice(){this.parent=null}Mlab_dt_bestpractice.prototype={get_template_rules:function(){return this.parent.app.template_config.components},page_check_content:function(e,n){var t=this.parent.app.template_config.components;for(var a in t)t[a].hasOwnProperty("max")&&e[a]>t[a].max.count&&$.inArray(t[a].max.message,n)<0&&n.push(t[a].max.message),t[a].hasOwnProperty("min")&&e[a]<t[a].min.count&&$.inArray(t[a].min.message,n)<0&&n.push(t[a].min.message)},component_check_content:function(e,n,t,a){var o=this.parent.app.template_config.components;if(this.parent.components[n].hasOwnProperty("conf")&&this.parent.components[n].conf.hasOwnProperty("category")){var s=this.parent.components[n].conf.category;if(t.hasOwnProperty(s)?t[s]++:t[s]=1,void 0!==this.parent.components[n].code&&void 0!==this.parent.components[n].code.getContentSize){var r=this.parent.components[n].code.getContentSize(e);o.hasOwnProperty(s)&&(o[s].hasOwnProperty("max")&&r>o[s].max.size&&$.inArray(o[s].max.message,a)<0&&a.push(o[s].max.message),o[s].hasOwnProperty("min")&&r<o[s].min.size&&$.inArray(o[s].min.message,a)<0&&a.push(o[s].min.message))}}}};
function Mlab_dt_design(){this.parent=null}Mlab_dt_design.prototype={domParserWrapper:function(){"use strict";var t=DOMParser.prototype,e=t.parseFromString;try{if((new DOMParser).parseFromString("","text/html"))return}catch(t){}t.parseFromString=function(t,a){if(/^\s*text\/html\s*(?:;|$)/i.test(a)){var n=document.implementation.createHTMLDocument("");return t.toLowerCase().indexOf("<!doctype")>-1?n.documentElement.innerHTML=t:n.body.innerHTML=t,n}return e.apply(this,arguments)}},component_add:function(t){this.parent.app.locked||(this.parent.components[t].conf.unique&&$("#"+this.parent.config.app.content_id).find("[data-mlab-type='"+t+"']").length>0?alert(_tr["mlab.dt.design.js.alert.only.one.comp"]):this.parent.api.getLibraries(t,!0))},component_add_html:function(t){this.parent.flag_dirty=!0;var e=void 0!==this.parent.components[t].conf.resizeable&&1==this.parent.components[t].conf.resizeable?"data-mlab-aspectratio='4:3' data-mlab-size='medium'":"",a=void 0!==this.parent.components[t].conf.display_dependent&&1==this.parent.components[t].conf.display_dependent?"data-mlab-displaydependent='true'":"";if(""!=e)n=$("<div data-mlab-type='"+t+"' "+a+" style='display: block;'><div data-mlab-sizer='1' "+e+" >"+this.parent.components[t].html+"</div></div>");else var n=$("<div data-mlab-type='"+t+"' "+a+" style='display: block;'>"+this.parent.components[t].html+"</div>");if($("#"+this.parent.config.app.content_id).append(n),n.on("click",function(){mlab.dt.api.display.componentHighlightSelected($(this))&&mlab.dt.design.component_menu_prepare()}),n.on("input",function(){mlab.dt.flag_dirty=!0}),void 0!==this.parent.components[t].conf.process_keypress&&this.parent.components[t].conf.process_keypress&&$(n).keydown(function(t){mlab.dt.components[$(this).data("mlab-type")].code.onKeyPress(t)}),$(".mlab_current_component").qtip("hide"),this.parent.api.display.componentHighlightSelected(n)&&this.component_menu_prepare(),window.scrollTo(0,document.body.scrollHeight),this.parent.components[t].hasOwnProperty("conf")&&this.parent.components[t].conf.hasOwnProperty("dependencies"))for(component in this.parent.components[t].conf.dependencies)this.feature_add(this.parent.components[t].conf.dependencies[0],!0);var o=this.parent.urls.component_added.replace("_APPID_",this.parent.app.id);o=o.replace("_COMPID_",t);var i=this,p=t,r=$.ajax({type:"GET",url:o,dataType:"json"});this.parent.drag_origin="sortable",""!=e&&this.parent.api.display.updateDisplay($(n).children("[data-mlab-sizer]"));var s=n,l=p,d=$("[data-mlab-comp-tool='credentials']");"[object Array]"===Object.prototype.toString.call(this.parent.components[p].conf.credentials)?this.parent.api.getCredentials(d,p,this.parent.components[p].conf.credentials,function(t,e){mlab.dt.design.component_store_credentials(t,e),i.component_run_code(s,l,!0)},!1,{component:n}):this.component_run_code(s,l,!0),r.done(function(t){"success"==t.result||(alert(t.msg+"'\n\n"+_tr["mlab.dt.design.js.alert.add.comp"]),$(n).remove())}),r.fail(function(t,e){alert(_tr["mlab.dt.design.js.alert.error.occurred"]+": '"+t.responseText+"'\n\n"+_tr["mlab.dt.design.js.alert.add.comp"]),$(n).remove(),this.parent.flag_dirty=!1})},component_run_code:function(el,comp_id,created){if(void 0!==this.parent.components[comp_id]&&void 0!==this.parent.components[comp_id].code)if(created){if(this.parent.components[comp_id].conf.experimental&&alert("Please be aware that this component is in the testing stage. Do not use it for apps you will share with others."),void 0!==this.parent.components[comp_id].code.onCreate&&this.parent.components[comp_id].code.onCreate(el),"string"==typeof this.parent.components[comp_id].conf.autorun_on_create){var func=this.parent.components[comp_id].conf.autorun_on_create;eval("this.parent.components[comp_id].code."+func+"(el, {currentTarget: mlab.dt.qtip_tools.qtip().tooltip.find('[data-mlab-comp-tool-id=\""+func+"\"]')[0]});")}}else void 0!==this.parent.components[comp_id].code.onLoad&&this.parent.components[comp_id].code.onLoad(el)},component_moveup:function(t){if(void 0===t)var t=$(".mlab_current_component");0!=t.length&&(t.fadeOut(500,function(){t.insertBefore(t.prev());var e=t;t.fadeIn(500,function(){e.qtip("api").reposition(null,!1),mlab.dt.api.properties_tooltip&&$(mlab.dt.api.properties_tooltip).qtip("api").reposition(null,!1)})}),this.parent.flag_dirty=!0)},component_movedown:function(){if(void 0===t)var t=$(".mlab_current_component");0!=t.length&&(t.fadeOut(500,function(){t.insertAfter(t.next());var e=t;t.fadeIn(500,function(){e.qtip("api").reposition(null,!1),mlab.dt.api.properties_tooltip&&$(mlab.dt.api.properties_tooltip).qtip("api").reposition(null,!1)})}),this.parent.flag_dirty=!0)},invert_color:function(t){t=[].slice.call(arguments).join(",").replace(/rgb\(|\)|rgba\(|\)|\s/gi,"").split(",");for(var e=0;e<t.length;e++)t[e]=(3===e?1:255)-t[e];return t.join(", ")},component_delete:function(t){var e=this;if(t){if(0==el.length)return;var a=el.data("mlab-type");void 0!==this.parent.components[a].code.onDelete&&this.parent.components[a].code.onDelete(el),mlab.dt.api.closeAllPropertyDialogs();var n=$(".mlab_current_component").prev();return 0==n.length&&(n=$(".mlab_current_component").next()),$(".mlab_current_component").qtip("hide"),$(".mlab_current_component").remove(),n.length>0&&this.parent.api.display.componentHighlightSelected(n)&&this.component_menu_prepare(),this.parent.flag_dirty=!0,!0}$("#mlab_dialog_delete").dialog({title:_tr["build_app.dialog.delete.title"],dialogClass:"no-close",modal:!0,buttons:[{text:_tr["mlab.dt.api.js.getLink.ok"],click:function(){$(this).dialog("destroy");var t=$(".mlab_current_component");if(0!=t.length){mlab.dt.api.closeAllPropertyDialogs();var a=t.prev();0==a.length&&(a=t.next()),t.qtip("hide");var n=t.data("mlab-type");void 0!==e.parent.components[n].code.onDelete&&e.parent.components[n].code.onDelete(t),t.remove(),a.length>0&&e.parent.api.display.componentHighlightSelected(a)&&e.component_menu_prepare(),e.parent.flag_dirty=!0}}},{text:_tr["mlab.dt.api.js.getLink.cancel"],click:function(){return $(this).dialog("destroy"),!1}}]})},component_help:function(){var t=$(".mlab_current_component").data("mlab-type"),e=this.parent.api.getLocaleComponentMessage(t,["extended_name"]),a=$(".mlab_help_icon"),n=_tr["mlab.dt.design.js.qtip.help.title"]+" - "+e;this.parent.api.displayExternalHelpfile(t,n,a,"mlab_comp_help_qTip")},component_cut:function(){mlab.dt.clipboard=$(".mlab_current_component").clone(),this.component_delete(!0)},component_copy:function(){mlab.dt.clipboard=$(".mlab_current_component").clone()},component_paste:function(){var t=mlab.dt.clipboard.data("mlab-type");this.parent.components[t].conf.unique&&$("#"+this.parent.config.app.content_id).find("[data-mlab-type='"+t+"']").length>0?alert(_tr["mlab.dt.design.js.alert.only.one.comp"]):($(".mlab_current_component").qtip("hide"),$(".mlab_current_component").removeClass("mlab_current_component"),$("#"+this.parent.config.app.content_id).append(mlab.dt.clipboard),this.parent.api.display.componentHighlightSelected(mlab.dt.clipboard),this.component_menu_prepare(),window.scrollTo(0,document.body.scrollHeight),mlab.dt.clipboard.on("click",function(){mlab.dt.api.display.componentHighlightSelected($(this))&&mlab.dt.design.component_menu_prepare()}),mlab.dt.clipboard.on("input",function(){mlab.dt.flag_dirty=!0}),void 0!==this.parent.components[t].conf.process_keypress&&this.parent.components[t].conf.process_keypress&&$(mlab.dt.clipboard).keydown(function(t){mlab.dt.components[$(this).data("mlab-type")].code.onKeyPress(t)}),this.parent.flag_dirty=!0)},component_edit_credentials:function(){var t=$(".mlab_current_component"),e=$("[data-mlab-comp-tool='credentials']"),a=t.data("mlab-type");"[object Array]"===Object.prototype.toString.call(this.parent.components[a].conf.credentials)&&this.parent.api.getCredentials(e,a,this.parent.components[a].conf.credentials,this.component_store_credentials,!0,{component:t})},feature_add:function(t,e){if(0==$(this.parent.app.curr_indexpage_html).find("#mlab_features_content").length)$(this.parent.app.curr_indexpage_html).find("body").append("<div id='mlab_features_content' style='display: none;'></div>");else if($(this.parent.app.curr_indexpage_html).find("#mlab_features_content [data-mlab-type='"+t+"']").length>0)return void(e||this.parent.utils.update_status("temporary",_tr["mlab.dt.design.js.update_status.feature.already.added"],!1));var a=this.parent.components[t].conf,n=void 0!==a.resizeable&&1==a.resizeable?"data-mlab-aspectratio='1:1' data-mlab-size='medium'":"",o=void 0!==a.display_dependent&&1==a.display_dependent||void 0!==a.resizeable&&1==a.resizeable?"data-mlab-displaydependent='true'":"";$(this.parent.app.curr_indexpage_html).find("#mlab_features_content").append("<div data-mlab-type='"+t+"' "+n+" "+o+" >"+this.parent.components[t].html+"</div>");var i=$(this.parent.app.curr_indexpage_html).find("#mlab_features_content [data-mlab-type='"+t+"']");if(i.length>0&&this.parent.components[t].code.onCreate(i[0]),"0"!=this.parent.app.curr_page_num&&"index"!=this.parent.app.curr_page_num){var p=this.parent.urls.feature_add.replace("_APPID_",this.parent.app.id);p=p.replace("_COMPID_",t),e||this.parent.utils.update_status("callback",_tr["mlab.dt.design.js.update_status.adding.feature"],!0);var r=this;$.get(p,function(t){"success"==t.result?(r.parent.utils.update_status("temporary",_tr["mlab.dt.design.js.update_status.feature.added"],!1),$("#mlab_features_list [data-mlab-feature-type='"+t.component_id+"']").addClass("mlab_item_applied")):r.parent.utils.update_status("temporary",t.msg,!1)})}},storage_plugin_setup:function(t,e,a){if(t.parent().attr("data-mlab-selected-storage"))mlab.dt.api.setVariable(a,"storage_plugin",""),t.parent().removeClass("mlab_item_applied").removeAttr("data-mlab-selected-storage");else{var n=this.parent.urls.storage_plugin_add.replace("_APPID_",this.parent.app.id);n=n.replace("_STORAGE_PLUGIN_ID_",e),this.parent.utils.update_status("callback",_tr["mlab.dt.design.js.update_status.adding.storage.plugin"],!0);var o=this;$.get(n,function(t){var n=$("[data-mlab-get-info='storage_plugins'] [data-mlab-storage-plugin-type='"+t.storage_plugin_id+"']");"success"==t.result?(n.parent().siblings().removeClass("mlab_item_applied").removeAttr("data-mlab-selected-storage"),o.parent.utils.update_status("temporary",_tr["mlab.dt.design.js.update_status.storage.plugin.added"],!1),n.addClass("mlab_item_applied").attr("data-mlab-selected-storage","true"),"[object Array]"===Object.prototype.toString.call(o.parent.components[e].conf.credentials)?o.parent.api.getCredentials(n,e,o.parent.components[e].conf.credentials,o.storage_plugin_store_credentials,!1,{storage_plugin_id:e,component:a}):(mlab.dt.api.setVariable(a,"storage_plugin",{name:e}),$(mlab.dt.qtip_tools).qtip().elements.content.find("[data-mlab-storage-plugin-type='storage_plugins']").slideUp())):o.parent.utils.update_status("temporary",t.msg,!1)})}},component_store_credentials:function(t,e){mlab.dt.api.setVariable(e.component,"credentials",t)},storage_plugin_store_credentials:function(t,e){mlab.dt.api.setVariable(e.component,"storage_plugin",{name:e.storage_plugin_id,credentials:t})},prepare_editable_area:function(){var t=this;$("#"+t.parent.config.app.content_id+"> div").each(function(e){$(this).droppable(t.parent.droppable_options).sortable(t.parent.sortable_options).on("click",function(){mlab.dt.api.display.componentHighlightSelected($(this))&&mlab.dt.design.component_menu_prepare()}).on("input",function(){mlab.dt.flag_dirty=!0}),comp_id=$(this).data("mlab-type"),t.component_run_code($(this),comp_id),void 0!==t.parent.components[comp_id].conf.process_keypress&&t.parent.components[comp_id].conf.process_keypress&&$(this).keydown(function(t){mlab.dt.components[$(this).data("mlab-type")].code.onKeyPress(t)})}),$("#"+t.parent.config.app.content_id).droppable(t.parent.droppable_options).sortable(t.parent.sortable_options)},component_menu_prepare:function(){var t=$(".mlab_current_component");if(!(t.length<1)){var e=this.parent.components[t.data("mlab-type")].conf,a=t.data("mlab-type"),n=(new Object,""),o=$("#mlab_toolbar_for_components .mlab_component_context_menu"),i=[];mlab.dt.api.getLocale();if($("#mlab_toolbar_for_components .mlab_component_toolbar_heading").text(this.parent.api.getLocaleComponentMessage(a,["extended_name"])),o.html(""),void 0!==e.custom){for(var p in this.parent.components[a].code)if("custom_"==p.substr(0,7)&&(n=p.slice(7),void 0!==e.custom[n])){var r=void 0!==e.custom[n].icon?"src='"+e.custom[n].icon+"'":"class='missing_icon'",s=this.parent.api.getLocaleComponentMessage(a,["custom",n,"tooltip"]),l=void 0!==e.custom[n].order?e.custom[n].order:0;if(void 0!==e.custom[n].newline&&!0===e.custom[n].newline)d="mlab_newline";else var d="";i[l]="<img onclick='(function(e){ mlab.dt.components."+a+".code."+p+"($(\".mlab_current_component\"), e);})(event)' title='"+s+"' class='"+d+"' data-mlab-comp-tool-id='"+p+"' "+r+" >"}o.append(i.join("")),o.append("<div class='clear'>&nbsp;</div>")}void 0!==e.credentials&&"[object Array]"===Object.prototype.toString.call(e.credentials)?$("[data-mlab-comp-tool='credentials']").removeClass("mlab_hidden"):$("[data-mlab-comp-tool='credentials']").addClass("mlab_hidden"),void 0!==e.storage_plugin&&1==e.storage_plugin?$("[data-mlab-comp-tool='storage_plugin']").removeClass("mlab_hidden"):$("[data-mlab-comp-tool='storage_plugin']").addClass("mlab_hidden"),void 0!==e.resizeable&&1==e.resizeable?($("[data-mlab-comp-tool='comp_size']").removeClass("mlab_hidden"),$("[data-mlab-comp-tool='comp_aspect']").removeClass("mlab_hidden"),$("#mlab_component_size_list li").removeClass("mlab_item_applied"),$("#mlab_component_aspect_list li").removeClass("mlab_item_applied"),$("#mlab_component_size_list [data-data-mlab-comp-size='"+t.data("mlab-comp-size")+"']").addClass("mlab_item_applied"),$("#mlab_component_aspect_list [data-data-mlab-comp-aspect='"+t.data("mlab-comp-aspect")+"']").addClass("mlab_item_applied")):($("[data-mlab-comp-tool='comp_size']").addClass("mlab_hidden"),$("[data-mlab-comp-tool='comp_aspect']").addClass("mlab_hidden"));var c="leftTop",m=t.offset().top;(m-=$(window).scrollTop())>450&&(c="leftBottom"),this.parent.qtip_tools=$(t).qtip({solo:!1,content:{text:function(){return $("#mlab_toolbar_for_components").clone(!0)}},position:{my:c,at:"rightTop",viewport:$(window)},show:{ready:!0,modal:{on:!1,blur:!1}},hide:!1,events:{hide:function(t,e){$(mlab.dt.api.properties_tooltip).qtip("hide"),e.destroy()},visible:function(t,e){$(mlab.dt.qtip_tools).qtip().elements.content.find("*").removeAttr("id")}},style:{classes:"qtip-light mlab_zindex_regular_tooltip",tip:!0}}),$(t).qtip("show")}},toggle_footer:function(){var t=$(".mlab_editor_footer"),e=$(".mlab_editor_footer_help");t.hasClass("mlab_transparent")?(t.removeClass("mlab_transparent"),e.removeClass("mlab_hidden")):(t.addClass("mlab_transparent"),e.addClass("mlab_hidden"))}};
function Mlab_dt_utils(){this.parent=null,this.timer_save=null}Mlab_dt_utils.prototype={update_status:function(t,e,s){if("permanent"!=t){if("temporary"==t)$("#mlab_statusbar_temporary").text(e),window.setTimeout(this.clear_status.bind(this),3e3);else if("callback"==t)$("#mlab_statusbar_temporary").text(e);else if("completed"==t)return $("#mlab_statusbar_temporary").text(""),$("#mlab_statusbar_progress_spin").spin(!1),void $("#mlab_statusbar_progress_spin").hide();void 0!==s&&1==s?($("#mlab_statusbar_progress_spin").show(),$("#mlab_statusbar_progress_spin").spin("small","#fff")):void 0!==s&&0==s&&($("#mlab_statusbar_progress_spin").spin(!1),$("#mlab_statusbar_progress_spin").hide())}else $("#mlab_statusbar_permanent").text(e)},clear_status:function(){this.update_status("completed")},timer_start:function(){var t=parseInt(this.parent.config.save_interval);t<60&&(t=60),this.timer_save=window.setTimeout(this.parent.management.page_save.bind(this.parent.management),1e3*t)},timer_stop:function(){window.clearTimeout(this.timer_save)},merge_objects:function(t,e){for(var s in t)"object"==typeof t[s]?(void 0===e[s]&&(e[s]=new Object),e[s]=this.merge_objects(t[s],e[s])):void 0===e[s]&&(e[s]=t[s]);return e},process_inheritance_helper:function(t,e){if(void 0!==t[e].conf.inherit){var s=t[e].conf.inherit;void 0!==t[s]?(t[s].inheritance_processed||"undefined"==t[s].conf.inherit||this.process_inheritance_helper(t,s),t[e]=this.merge_objects(t[s],t[e]),t[e].inheritance_processed=!0):console.log("Parent object for "+e+" does not exist:"+s)}},process_inheritance:function(t){for(index in t)this.process_inheritance_helper(t,index)},getCookie:function(t){for(var e=t+"=",s=document.cookie.split(";"),i=0;i<s.length;i++){for(var r=s[i];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(e))return r.substring(e.length,r.length)}return 1}};
$.mobile.autoInitializePage=!1,$(document).ready(function(){bowser.gecko||bowser.chrome||(alert(_tr["mlab_editor.init.js.alert.browser.support"]),$("body").append('<div id="mlab_editor_disabled" style="background-color: gray; position: absolute;top:0;left:0;width: 100%;height:100%;z-index:2;opacity:0.4;filter: alpha(opacity = 50)"></div>')),Mlab=function(){var t=this;this.locale=document.mlab_temp_vars.locale,this.api=new Mlab_api,this.api.parent=t,this.dt={uid:0,config:new Object,paths:new Object,app:new Object,page:new Object,flag_dirty:!1,counter_saving_page:0,drag_origin:"sortable",mlab_component_cur_tooltip:null,droppable_options:{drop:function(t,e){mlab.dt.flag_dirty=!0}},sortable_options:{placeholder:"mlab_component_placeholder",revert:!1,helper:"clone",cancel:"[contenteditable]",stop:function(t,e){"sortable"==mlab.dt.drag_origin&&"true"==e.item.data("contenteditable")&&e.item.attr("contenteditable","true"),mlab.dt.flag_dirty=!0}},api:new Mlab_dt_api,bestpractice:new Mlab_dt_bestpractice,design:new Mlab_dt_design,management:new Mlab_dt_management,utils:new Mlab_dt_utils},this.initialise_dt_parents=function(){t.dt.parent=t,t.dt.api.parent=t.dt,t.dt.api.display.parent=t.dt.api,t.dt.bestpractice.parent=t.dt,t.dt.design.parent=t.dt,t.dt.management.parent=t.dt,t.dt.utils.parent=t.dt}},mlab=new Mlab,mlab.initialise_dt_parents(),$.get(document.mlab_temp_vars.appbuilder_root_url+document.mlab_temp_vars.app_id+"/"+document.mlab_temp_vars.page_num+"/load_variables",function(data){"success"===data.result?(mlab.dt.uid=data.mlab_uid,mlab.dt.user_email=data.mlab_current_user_email,mlab.dt.app=data.mlab_app,mlab.dt.app.curr_page_num=data.mlab_app_page_num,mlab.dt.app.app_checksum=data.mlab_app_checksum,mlab.dt.app.compiled_files=data.mlab_compiled_files,mlab.dt.config=data.mlab_config,mlab.dt.urls=data.mlab_urls,window.onbeforeunload=function(){var t=mlab.dt.urls.editor_closed.replace("_UID_",mlab.dt.uid);if($.ajax({url:t,async:!1}),mlab.dt.flag_dirty)return _tr["mlab_editor.init.js.alert.unsaved"];var e=$("#mlab_toolbar_components h3");void 0!==e&&e.each(function(){var t=$(this).data("mlab-category");$(this).hasClass("ui-state-active")?document.cookie="mlabCompCat"+t+"=0; expires=Thu, 18 Dec 2053 12:00:00 UTC; path=/":document.cookie="mlabCompCat"+t+"=1; expires=Thu, 18 Dec 2053 12:00:00 UTC; path=/"})},$.get(document.mlab_temp_vars.appbuilder_root_url+document.mlab_temp_vars.app_id+"/load_components",function(data){if("success"===data.result){var loc=mlab.dt.api.getLocale();mlab.dt.components=data.mlab_components,mlab.dt.storage_plugins={};var components_html={},category_translations={},features_html=[],additional_html="",comp_type;for(type in mlab.dt.components)!1!==mlab.dt.components[type].code&&eval("mlab.dt.components['"+type+"'].code = new function() { "+mlab.dt.components[type].code+"};");mlab.dt.utils.process_inheritance(mlab.dt.components);for(type in mlab.dt.components){mlab.dt.components[type].code.config=mlab.dt.components[type].conf;var c=mlab.dt.components[type];if(c.accessible&&!c.is_storage_plugin){var tt=mlab.dt.api.getLocaleComponentMessage(type,["tooltip"]),tte=mlab.dt.api.getLocaleComponentMessage(type,["footer_tip"]),eName=mlab.dt.api.getLocaleComponentMessage(type,["extended_name"]);void 0===components_html[c.conf.category]&&(components_html[c.conf.category]=[],category_translations[c.conf.category]=mlab.dt.api.getLocaleComponentMessage(type,["category_name"])),comp_type=c.is_feature?"feature":"component",components_html[c.conf.category][parseInt(c.order_by)]="<div data-mlab-type='"+type+"' onclick='mlab.dt.design."+comp_type+'_add("'+type+"\");' title='"+tt+"' class='mlab_button_components' style='background-image: url(\""+mlab.dt.config.urls.component+type+"/"+mlab.dt.config.component_files.ICON+"\");'></div><div class='mlab_component_footer_tip'>"+tte+"</div>"}else c.accessible&&c.is_storage_plugin&&(mlab.dt.storage_plugins[type]=eName)}var cookieExists=mlab.dt.utils.getCookie("mlabCompCattext");1===cookieExists&&(document.cookie="mlabCompCattext=0; expires=Thu, 18 Dec 2053 12:00:00 UTC; path=/");for(category in components_html){var activeCat=Number(mlab.dt.utils.getCookie("mlabCompCat"+category));$("<div><h3 data-mlab-category='"+category+"'><div class='mlab_category_name'>"+category_translations[category]+"</div></h3><div>"+components_html[category].join("")+"</div></div>").appendTo("#mlab_toolbar_components").accordion({heightStyle:"content",active:activeCat,collapsible:!0})}mlab.dt.utils.process_inheritance(mlab.dt.components);for(index in mlab.dt.components)void 0!==mlab.dt.components[index].code&&!1!==mlab.dt.components[index].code&&(mlab.dt.components[index].code.api=mlab.dt.api);$(".mlab_button_components").mouseover(function(t){$(".mlab_editor_footer_help").text(t.currentTarget.nextSibling.textContent)}),$(".mlab_button_components").mouseout(function(t){$(".mlab_editor_footer_help").text("")}),mlab.dt.management.app_open(document.mlab_temp_vars.app_id,document.mlab_temp_vars.page_num),delete document.mlab_temp_vars,$("#mlab_statusbar_progress_spin").spin("small","#fff"),$("[data-mlab-comp-tool='move_up']").on("click",function(){mlab.dt.design.component_moveup()}),$("[data-mlab-comp-tool='move_down']").on("click",function(){mlab.dt.design.component_movedown()}),$("[data-mlab-comp-tool='delete']").on("click",function(){mlab.dt.design.component_delete()}),$("[data-mlab-comp-tool='help']").on("click",function(){mlab.dt.design.component_help()}),$("[data-mlab-comp-tool='cut']").on("click",function(){mlab.dt.design.component_cut()}),$("[data-mlab-comp-tool='copy']").on("click",function(){mlab.dt.design.component_copy()}),$("[data-mlab-comp-tool='paste']").on("click",function(){mlab.dt.design.component_paste()}),$("[data-mlab-comp-tool='redo']").on("click",function(){document.execCommand("redo")}),$("[data-mlab-comp-tool='undo']").on("click",function(){document.execCommand("undo")}),$("#mlab_page_control_title").on("click",function(){mlab.dt.api.editContent(this),$("#mlab_page_control_title_actions").show(),$("#mlab_page_control_title").attr("title",_tr["app.builder.page.tooltip.page.name.edit"])}),$("#mlab_page_control_save_title").on("click",function(){$("#mlab_page_control_title_actions").hide(),$("#mlab_page_control_title").attr("title",_tr["app.builder.page.tooltip.page.name"]),mlab.dt.management.page_update_title()}),$("#mlab_page_control_cancel_title").on("click",function(){$("#mlab_page_control_title_actions").hide(),$("#mlab_page_control_title").attr("title",_tr["app.builder.page.tooltip.page.name"]),$("#mlab_page_control_title").text(mlab.dt.app.curr_pagetitle)}),$("#mlab_page_control_new").on("click",function(){mlab.dt.management.page_new()}),$("#mlab_page_control_import").on("click",function(){$("#mlab_dialog_import").dialog({resizable:!1,height:120,modal:!0})}),$("#mlab_page_control_delete").on("click",function(){mlab.dt.management.page_delete()}),$("#mlab_page_help").on("click",function(){page_help(event)}),$("#mlab_button_help").on("click",function(){mlab.dt.design.toggle_footer()}),$("#mlab_editor_menu_dropdown").on("click",function(t){$("#mlab_user_menu_dropdown_content").hasClass("mlab_show_user_dropdown")&&($("#mlab_user_menu_dropdown_content").toggleClass("mlab_show_user_dropdown"),$("#mlab_user_menu_dropdown").toggleClass("mlab_show_user_dropdown_tab_selected")),$("#mlab_editor_menu_dropdown_content").toggleClass("mlab_show_editor_dropdown"),$("#mlab_editor_menu_dropdown").toggleClass("mlab_show_editor_dropdown_tab_selected"),t.stopPropagation()}),$("#mlab_user_menu_dropdown").on("click",function(t){$("#mlab_editor_menu_dropdown_content").hasClass("mlab_show_editor_dropdown")&&($("#mlab_editor_menu_dropdown_content").toggleClass("mlab_show_editor_dropdown"),$("#mlab_editor_menu_dropdown").toggleClass("mlab_show_editor_dropdown_tab_selected")),$("#mlab_user_menu_dropdown_content").toggleClass("mlab_show_user_dropdown"),$("#mlab_user_menu_dropdown").toggleClass("mlab_show_user_dropdown_tab_selected"),t.stopPropagation()}),$("#mlab_page_control_pagelist").on("click",function(t){$("#mlab_page_management").toggleClass("mlab_show"),t.stopPropagation()}),$(document).on("click",function(t){$("#mlab_editor_menu_dropdown_content").hasClass("mlab_show_editor_dropdown")&&($("#mlab_editor_menu_dropdown_content").toggleClass("mlab_show_editor_dropdown"),$("#mlab_editor_menu_dropdown").toggleClass("mlab_show_editor_dropdown_tab_selected")),$("#mlab_user_menu_dropdown_content").hasClass("mlab_show_user_dropdown")&&($("#mlab_user_menu_dropdown_content").toggleClass("mlab_show_user_dropdown"),$("#mlab_user_menu_dropdown").toggleClass("mlab_show_user_dropdown_tab_selected")),$("#mlab_page_management").hasClass("mlab_show")&&$("#mlab_page_management").toggleClass("mlab_show")}),$("#mlab_page_save_all").on("click",function(){return mlab.dt.management.page_save(void 0,!0),$("#mlab_editor_menu_dropdown_content").toggleClass("mlab_show_editor_dropdown"),$("#mlab_editor_menu_dropdown").toggleClass("mlab_show_editor_dropdown_tab_selected"),!1}),$("[data-mlab-comp-tool='storage_plugin']").on("click",function(){var t=$(this).siblings("[data-mlab-get-info='storage_plugins']");t.is(":visible")||t.html(mlab.dt.api.getStoragePluginList(mlab.dt.api.getSelectedComponent())),t.slideToggle()}),$("[data-mlab-comp-tool='credentials']").on("click",function(){mlab.dt.design.component_edit_credentials()}),$("[data-mlab-comp-tool='comp_size']").on("click",function(t){mlab.dt.api.closeAllPropertyDialogs();var e=t.currentTarget;mlab.dt.api.properties_tooltip=$(e).qtip({solo:!1,content:{text:$("#mlab_component_size_list").clone(),title:_tr["mlab_editor.init.js.qtip.comp.size.title"],button:!0},position:{my:"leftMiddle",at:"rightMiddle",viewport:$(window)},show:{ready:!0,modal:{on:!0,blur:!1}},hide:!1,style:{classes:"mlab_zindex_top_tooltip",tip:!0},events:{hide:function(t,e){e.destroy(),mlab.dt.api.properties_tooltip=!1},visible:function(){$("[data-mlab-comp-size='small']").on("click",function(){mlab.dt.api.display.setSize($(".mlab_current_component"),"small"),$("[data-mlab-get-info='comp_sizes']").hide()}),$("[data-mlab-comp-size='medium']").on("click",function(){mlab.dt.api.display.setSize($(".mlab_current_component"),"medium"),$("[data-mlab-get-info='comp_sizes']").hide()}),$("[data-mlab-comp-size='large']").on("click",function(){mlab.dt.api.display.setSize($(".mlab_current_component"),"large"),$("[data-mlab-get-info='comp_sizes']").hide()})}}})}),$("[data-mlab-comp-tool='comp_aspect']").on("click",function(t){mlab.dt.api.closeAllPropertyDialogs();var e=t.currentTarget;mlab.dt.api.properties_tooltip=$(e).qtip({solo:!1,content:{text:$("#mlab_component_aspect_list").clone(),title:_tr["mlab_editor.init.js.qtip.comp.aspect.title"],button:!0},position:{my:"leftMiddle",at:"rightMiddle",viewport:$(window)},show:{ready:!0,modal:{on:!0,blur:!1}},hide:!1,style:{classes:"mlab_zindex_top_tooltip",tip:!0},events:{hide:function(t,e){e.destroy(),mlab.dt.api.properties_tooltip=!1},visible:function(){$("[data-mlab-comp-aspect='4:3']").on("click",function(){mlab.dt.api.display.setAspectRatio($(".mlab_current_component"),"4:3"),$("[data-mlab-get-info='comp_aspects']").hide()}),$("[data-mlab-comp-aspect='16:9']").on("click",function(){mlab.dt.api.display.setAspectRatio($(".mlab_current_component"),"16:9"),$("[data-mlab-get-info='comp_aspects']").hide()}),$("[data-mlab-comp-aspect='1:1']").on("click",function(){mlab.dt.api.display.setAspectRatio($(".mlab_current_component"),"1:1"),$("[data-mlab-get-info='comp_aspects']").hide()})}}})}),$("#mlab_credit_icons").qtip({hide:{delay:500,fixed:!0},position:{my:"left bottom",at:"right center",adjust:{screen:!0}},content:{text:function(){return $("<div>The icons on this page are made by <a href='http://www.freepik.com' target='_blank' title='Freepik'>Freepik</a>, <a href='http://www.flaticon.com/authors/simpleicon' target='_blank' title='SimpleIcon'>SimpleIcon</a>, <a href='http://www.flaticon.com/authors/dave-gandy' target='_blank' title='Dave Gandy'>Dave Gandy</a>, <a href='http://www.flaticon.com/authors/anton-saputro' target='_blank' title='Anton Saputro'>Anton Saputro</a> and <a href='http://www.flaticon.com/authors/yannick' target='_blank' title='Yannick'>Yannick</a> from <a href='http://www.flaticon.com' target='_blank' title='Flaticon'>www.flaticon.com</a> and are licensed by <a href='http://creativecommons.org/licenses/by/3.0/' target='_blank' title='Creative Commons BY 3.0'>CC BY 3.0</a> - and many are made by the Sinett project at FFI.no</div>").html()},title:{text:"Credit for icons"}},style:{classes:"mlab_qtip_tooltip mlab_qtip_menu_tooltip"}}),$("#mlab_credit_icons").qtip({hide:{delay:500,fixed:!0},position:{my:"left bottom",at:"right center",viewport:$(window)},content:{text:function(){return $("<div>The icons on this page are made by <a href='http://www.freepik.com' target='_blank' title='Freepik'>Freepik</a>, <a href='http://www.flaticon.com/authors/simpleicon' target='_blank' title='SimpleIcon'>SimpleIcon</a>, <a href='http://www.flaticon.com/authors/dave-gandy' target='_blank' title='Dave Gandy'>Dave Gandy</a>, <a href='http://www.flaticon.com/authors/anton-saputro' target='_blank' title='Anton Saputro'>Anton Saputro</a> and <a href='http://www.flaticon.com/authors/yannick' target='_blank' title='Yannick'>Yannick</a> from <a href='http://www.flaticon.com' target='_blank' title='Flaticon'>www.flaticon.com</a> and are licensed by <a href='http://creativecommons.org/licenses/by/3.0/' target='_blank' title='Creative Commons BY 3.0'>CC BY 3.0</a> - and many are made by the Sinett project at FFI.no</div>").html()},title:{text:"Credit for icons"}},style:{classes:"mlab_qtip_tooltip mlab_qtip_menu_tooltip",tip:!0}}),$.each(mlab.dt.config.compiler_service.supported_platforms,function(t,e){$("#mlab_download_"+e+"_icon").qtip({hide:{delay:500,fixed:!0},content:{text:function(){return $("[data-mlab-download-link-info='"+e+"']").html()},title:{text:_tr["mlab_editor.init.js.qtip.download.app.title"]+" "+e}},style:{classes:"mlab_qtip_tooltip mlab_qtip_menu_tooltip",tip:!0}})})}else alert(_tr["mlab_editor.init.js.compiling.failed.loading.comps"])})):alert(_tr["mlab_editor.init.js.compiling.failed.loading.var"])})});